/*! For license information please see adtrace-latest.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.adtrace=t():e.adtrace=t()}(self,(()=>(()=>{var e={702:function(e,t,n){e.exports=function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,i=void 0,a=void 0,u=function(e,t){k[o]=e,k[o+1]=t,2===(o+=2)&&(a?a(w):P())};function s(e){a=e}function c(e){u=e}var l="undefined"!=typeof window?window:void 0,f=l||{},d=f.MutationObserver||f.WebKitMutationObserver,v="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function m(){return function(){return process.nextTick(w)}}function h(){return void 0!==i?function(){i(w)}:b()}function g(){var e=0,t=new d(w),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function y(){var e=new MessageChannel;return e.port1.onmessage=w,function(){return e.port2.postMessage(0)}}function b(){var e=setTimeout;return function(){return e(w,1)}}var k=new Array(1e3);function w(){for(var e=0;e<o;e+=2)(0,k[e])(k[e+1]),k[e]=void 0,k[e+1]=void 0;o=0}function S(){try{var e=Function("return this")().require("vertx");return i=e.runOnLoop||e.runOnContext,h()}catch(e){return b()}}var P=void 0;function x(e,t){var n=this,r=new this.constructor(_);void 0===r[N]&&H(r);var o=n._state;if(o){var i=arguments[o-1];u((function(){return V(o,r,i,n._result)}))}else U(n,r,e,t);return r}function D(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(_);return L(n,e),n}P=v?m():d?g():p?y():void 0===l?S():b();var N=Math.random().toString(36).substring(2);function _(){}var I=void 0,A=1,O=2;function C(){return new TypeError("You cannot resolve a promise with itself")}function E(){return new TypeError("A promises callback cannot return that same promise.")}function R(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function T(e,t,n){u((function(e){var r=!1,o=R(n,t,(function(n){r||(r=!0,t!==n?L(e,n):K(e,n))}),(function(t){r||(r=!0,q(e,t))}),"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,q(e,o))}),e)}function j(e,t){t._state===A?K(e,t._result):t._state===O?q(e,t._result):U(t,void 0,(function(t){return L(e,t)}),(function(t){return q(e,t)}))}function B(e,n,r){n.constructor===e.constructor&&r===x&&n.constructor.resolve===D?j(e,n):void 0===r?K(e,n):t(r)?T(e,n,r):K(e,n)}function L(t,n){if(t===n)q(t,C());else if(e(n)){var r=void 0;try{r=n.then}catch(e){return void q(t,e)}B(t,n,r)}else K(t,n)}function M(e){e._onerror&&e._onerror(e._result),F(e)}function K(e,t){e._state===I&&(e._result=t,e._state=A,0!==e._subscribers.length&&u(F,e))}function q(e,t){e._state===I&&(e._state=O,e._result=t,u(M,e))}function U(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+A]=n,o[i+O]=r,0===i&&e._state&&u(F,e)}function F(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)r=t[a],o=t[a+n],r?V(n,r,o,i):o(i);e._subscribers.length=0}}function V(e,n,r,o){var i=t(r),a=void 0,u=void 0,s=!0;if(i){try{a=r(o)}catch(e){s=!1,u=e}if(n===a)return void q(n,E())}else a=o;n._state!==I||(i&&s?L(n,a):!1===s?q(n,u):e===A?K(n,a):e===O&&q(n,a))}function G(e,t){try{t((function(t){L(e,t)}),(function(t){q(e,t)}))}catch(t){q(e,t)}}var W=0;function Y(){return W++}function H(e){e[N]=W++,e._state=void 0,e._result=void 0,e._subscribers=[]}function z(){return new Error("Array Methods must be provided an Array")}var J=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(_),this.promise[N]||H(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?K(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&K(this.promise,this._result))):q(this.promise,z())}return e.prototype._enumerate=function(e){for(var t=0;this._state===I&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===D){var o=void 0,i=void 0,a=!1;try{o=e.then}catch(e){a=!0,i=e}if(o===x&&e._state!==I)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===te){var u=new n(_);a?q(u,i):B(u,e,o),this._willSettleAt(u,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===I&&(this._remaining--,e===O?q(r,n):this._result[t]=n),0===this._remaining&&K(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;U(e,void 0,(function(e){return n._settledAt(A,t,e)}),(function(e){return n._settledAt(O,t,e)}))},e}();function Q(e){return new J(this,e).promise}function X(e){var t=this;return r(e)?new t((function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))}function Z(e){var t=new this(_);return q(t,e),t}function $(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ee(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var te=function(){function e(t){this[N]=Y(),this._result=this._state=void 0,this._subscribers=[],_!==t&&("function"!=typeof t&&$(),this instanceof e?G(this,t):ee())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var n=this,r=n.constructor;return t(e)?n.then((function(t){return r.resolve(e()).then((function(){return t}))}),(function(t){return r.resolve(e()).then((function(){throw t}))})):n.then(e,e)},e}();function ne(){var e=void 0;if(void 0!==n.g)e=n.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=te}return te.prototype.then=x,te.all=Q,te.race=X,te.resolve=D,te.reject=Z,te._setScheduler=s,te._setAsap=c,te._asap=u,te.polyfill=ne,te.Promise=te,te}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){e(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}))}return n}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(r,{default:()=>hr});var l=1e3,f=36e5,d=24*f,v="general",p="gdpr",m={TRANSACTION_ERROR:"XHR transaction failed due to an error",SERVER_MALFORMED_RESPONSE:"Response from server is malformed",SERVER_INTERNAL_ERROR:"Internal error occurred on the server",SERVER_CANNOT_PROCESS:"Server was not able to process the request, probably due to error coming from the client",NO_CONNECTION:"No internet connectivity",SKIP:"Skipping slower attempt",MISSING_URL:"Url is not provided"},h="noStorage",g="indexedDB",y="localStorage";function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function k(e){return!Object.keys(e).length&&e.constructor===Object}function w(e){return"object"===b(e)&&null!==e&&!(e instanceof Array)}function S(e){try{return w(JSON.parse(e))}catch(e){return!1}}function P(e,t,n){function r(e){return Array.isArray(t)?t.every((function(t){return e[t]===n[t]})):e[t]===n}for(var o=0;o<e.length;o+=1)if(r(e[o]))return o;return-1}function x(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.reduce((function(t,n){return o(o({},t),{},e({},n.key,n.value))}),{})}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.filter((function(e){return-1!==t.indexOf(e)}))}function N(e,t){return new RegExp("\\/".concat(t,"(\\/.*|\\?.*){0,1}$")).test(e)}function _(t,n){var r=s(n,2),i=r[0],a=r[1];return o(o({},t),{},e({},i,a))}function I(e){return Object.keys(e).map((function(t){return[t,e[t]]}))}function A(e){return Object.keys(e).map((function(t){return e[t]}))}function O(e){return w(e)?!k(e):!!e||0===e}function C(){try{var e=(new Date).toString(),t=window.localStorage;t.setItem(e,e);var n=t.getItem(e)===e;return t.removeItem(e),!(!n||!t)}catch(e){return!1}}const E={namespace:"adtrace-sdk",version:"2.2.0",env:"production"};var R,T="error",j="warning",B="info",L="verbose",M=(e(R={},"none",-1),e(R,T,0),e(R,j,1),e(R,B,2),e(R,L,3),R),K={log:"  ",info:" ",warn:" ",error:""},q={development:L,production:T,test:L},U=V(),F="";function V(){return q[E.env]||T}function G(e,t){var n;if(!(M[U]<M[t])){for(var r=(new Date).toISOString(),o=K[e],i=["[".concat(E.namespace,"]"),r,"".concat(e.toUpperCase(),":").concat(o)],a=F?document.querySelector(F):null,u=arguments.length,s=new Array(u>2?u-2:0),c=2;c<u;c++)s[c-2]=arguments[c];(n=console)[e].apply(n,i.concat(s)),a&&(a.textContent+="".concat(i.join(" ")," ").concat(s.map((function(e){return w(e)?JSON.stringify(e):e})).join(" "),"\n"),a.scrollTop=a.scrollHeight)}}function W(e,t){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];G.apply(void 0,[e,t].concat(r))}}const Y={setLogLevel:function(e,t){e&&-1===Object.keys(M).indexOf(e)?G("error","error","You must set one of the available log levels: verbose, info, warning, error or none"):(U=e||V(),F=t||F,G("info",e,"Log level set to ".concat(U)))},log:W("log",L),info:W("info",B),warn:W("warn",j),error:W("error",T)};var H={},z={},J=["appToken","environment"],Q=[].concat(J,["defaultTracker","externalDeviceId"]),X=["customUrl","dataResidency","urlStrategy","eventDeduplicationListLimit","namespace"];function Z(e){var t=J.filter((function(t){return!e[t]}));return!!t.length&&(Y.error("You must define ".concat(function(e){if(!e.length)return"";if(1===e.length)return"".concat(e[0]);var t=e.length-1,n=e.slice(0,t).join(", ");return"".concat(n," and ").concat(e[t])}(t))),!0)}const $=o(o({},{sessionWindow:18e5,sessionTimerWindow:6e4,requestValidityWindow:28*d}),{},{set:function(e){if(!Z(e)){var t=[].concat(c(Q),X).filter((function(t){return!!e[t]})).map((function(t){return[t,e[t]]}));H=t.filter((function(e){var t=s(e,1)[0];return-1!==Q.indexOf(t)})).reduce(_,{}),z=t.filter((function(e){var t=s(e,1)[0];return-1!==X.indexOf(t)})).reduce(_,{})}},getBaseParams:function(){return o({},H)},getCustomConfig:function(){return o({},z)},isInitialised:function(){return J.reduce((function(e,t){return e&&!!H[t]}),!0)},hasMissing:Z,destroy:function(){H={},z={}}});var ee,te,ne,re,oe;!function(e){e.Queue="queue",e.ActivityState="activityState",e.GlobalParams="globalParams",e.EventDeduplication="eventDeduplication"}(te||(te={})),function(e){e.Preferences="preferences"}(ne||(ne={})),function(e){e.Queue="q",e.ActivityState="as",e.GlobalParams="gp",e.EventDeduplication="ed"}(re||(re={})),function(e){e.Preferences="p"}(oe||(oe={}));var ie={fields:{thirdPartySharingDisabled:{key:"td",keys:{reason:{key:"r",values:e({},v,1)},pending:{key:"p",values:{false:0,true:1}}}},sdkDisabled:{key:"sd",keys:{reason:{key:"r",values:(ee={},e(ee,v,1),e(ee,p,2),ee)},pending:{key:"p",values:{false:0,true:1}}}}}};function ae(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"values")}function ue(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"keys")}function se(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"composite")}function ce(e){return!!e&&"string"!=typeof e}const le={queue:{name:re.Queue,scheme:{keyPath:"timestamp",autoIncrement:!1,fields:{url:{key:"u",values:{"/session":1,"/event":2,"/gdpr_forget_device":3,"/sdk_click":4,"/disable_third_party_sharing":5}},method:{key:"m",values:{GET:1,POST:2,PUT:3,DELETE:4}},timestamp:"t",createdAt:"ca",params:{key:"p",keys:{timeSpent:"ts",sessionLength:"sl",sessionCount:"sc",eventCount:"ec",lastInterval:"li",eventToken:"et",revenue:"re",currency:"cu",callbackParams:"cp",valueParams:"pp"}}}}},activityState:{name:re.ActivityState,scheme:{keyPath:"uuid",autoIncrement:!1,fields:{uuid:{key:"u",values:{unknown:"-"}},timeSpent:"ts",sessionLength:"sl",sessionCount:"sc",eventCount:"ec",lastActive:"la",lastInterval:"li",installed:{key:"in",values:{false:0,true:1}},attribution:{key:"at",keys:{adid:"a",tracker_token:"tt",tracker_name:"tn",network:"nt",campaign:"cm",adgroup:"ag",creative:"cr",click_label:"cl",state:{key:"st",values:{installed:1,reattributed:2}}}}}}},globalParams:{name:re.GlobalParams,scheme:{keyPath:"keyType",autoIncrement:!1,index:"type",fields:{keyType:{key:"kt",composite:["key","type"]},key:"k",value:"v",type:{key:"t",values:{callback:1,value:2}}}}},eventDeduplication:{name:re.EventDeduplication,scheme:{keyPath:"internalId",autoIncrement:!0,fields:{internalId:"ii",id:"i"}}},preferences:{name:oe.Preferences,scheme:ie,permanent:!0}};function fe(e){try{return JSON.parse(e)}catch(t){return e}}function de(e,t,n){var r,i=ae(n)?{values:(r=n.values,I(r).map((function(e){var t=s(e,2),n=t[0];return[t[1],fe(n)]})).reduce(_,{}))}:{},a=ue(n)?{keys:ve(e,n.keys)}:{},u=se(n)?{composite:n.composite.map((function(t){return pe(e,t)}))}:{};return o(o(o({key:t},i),a),u)}function ve(e,t){return I(t).map((function(t){var n=s(t,2),r=n[0],o=n[1];return ce(o)?[o.key,de(e,r,o)]:[o,r]})).reduce(_,{})}function pe(e,t){if(t){var n=le[e].scheme.fields[t];return ce(n)?n.key:n||t}}var me=I(le).map((function(e){var t=s(e,2),n=t[0],r=t[1];return[n,{keyPath:r.scheme.keyPath,autoIncrement:r.scheme.autoIncrement,index:r.scheme.index,fields:r.scheme.fields}]})).reduce(_,{}),he=I(me).map((function(e){var t=s(e,2),n=t[0],r=t[1];return[n,{keyPath:pe(n,r.keyPath),autoIncrement:r.autoIncrement,index:pe(n,r.index),fields:ve(n,r.fields)}]})).reduce(_,{}),ge=I(le).reduce((function(e,t){var n=s(t,2)[1];return e.concat(n.scheme.fields)}),[]).map((function(e){return A(e).filter(ae).map((function(e){return I(e.values)})).reduce((function(e,t){return e.concat(t)}),[])})).reduce((function(e,t){return e.concat(t)}),[]).reduce(_,{}),ye=I(le).map((function(e){var t=s(e,2),n=t[0],r=t[1];return[n,{name:r.name,permanent:r.permanent}]})).reduce(_,{});const be={left:me,right:he,values:ge,storeNames:{left:ye,right:(ke=ye,we=I(ke).map((function(e){var t=s(e,2),n=t[0],r=t[1],o={name:n,permanent:r.permanent};return[r.name,o]})),we.reduce(_,{}))}};var ke,we,Se,Pe;"undefined"==typeof Promise&&n(702).Promise;function xe(e){return w(e)}function De(e,t){return e&&void 0!==e[t]?e[t]:t}function Ne(t,n,r,i){if(r){var a=i||be[n][Oe(t,Pe.right)].fields;return I(r).map((function(e){var r=s(e,2),o=r[0],i=r[1];return function(e,t,n,r,o){if(!o)return[n,r];var i=ce(o)?o.key:o;return xe(r)?[i,Ne(e,t,r,ue(o)?o.keys:null)]:[i,De(ae(o)?o.values:null,r)]}(t,n,o,i,a[o])})).reduce((function(t,n){var r=s(n,2),i=r[0],a=r[1];return o(o({},t),{},e({},i,a))}),{})}}function _e(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return n.map((function(n){return Ne(e,t,n)}))}function Ie(e,t,n){var r=be[t][Oe(e,Pe.right)],o=r.fields[r.keyPath],i=n instanceof Array?n.slice():[n],a=(se(o)?o.composite:[r.keyPath]).map((function(e,t){var n=r.fields[e];return De(ae(n)?n.values:null,i[t])}));return 1===a.length?a[0]:a}function Ae(e){return be.values[e]||e}function Oe(e,t){return(be.storeNames[t][e]||{}).name||e}function Ce(e,t){return{name:t.name,message:t.message.replace('"'.concat(e,'"'),Oe(e,Pe.right))}}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Te(e,t,n){return t&&Re(e.prototype,t),n&&Re(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function je(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e+"",r=1;r<=t;r+=1)e<Math.pow(10,r)&&(n="0".concat(n));return n}function Be(e){var t=e?new Date(e):new Date,n=function(e){var t=je(e.getDate()),n=je(e.getMonth()+1);return[e.getFullYear(),n,t].join("-")}(t),r=function(e){var t=je(e.getHours(),1),n=je(e.getMinutes()),r=je(e.getSeconds()),o=je(e.getMilliseconds(),2);return[t,n,r].join(":")+"."+o}(t),o=function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+je(Math.floor(Math.abs(t)/60))+je(Math.abs(t)%60)}(t);return"".concat(n,"T").concat(r,"Z").concat(o)}function Le(e,t){return isNaN(e)||isNaN(t)?0:Math.abs(t-e)}!function(e){e.LowerBound="lowerBound",e.UpperBound="upperBound"}(Se||(Se={})),function(e){e.right="right",e.left="left"}(Pe||(Pe={}));var Me={},Ke=!1,qe=!1;function Ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Me=Ke?o({},e):{}}function Fe(){Ke&&(Me.lastInterval=function(){var e=Me.lastActive;if(e)return Math.round(Le(e,Date.now())/l);return-1}(),Me.lastActive=Date.now())}function Ve(e){Me=o(o({},Me),e)}function Ge(){qe=!0}function We(){var e=Me.lastActive;return Math.round(Le(e,Date.now())/l)}function Ye(){return(Me.timeSpent||0)+(qe?We():0)}function He(){var e=Le(Me.lastActive,Date.now())<$.sessionWindow,t=qe||!qe&&e;return(Me.sessionLength||0)+(t?We():0)}function ze(){Ke&&(Ve({timeSpent:Ye(),sessionLength:He()}),Fe())}const Je={get current(){return Ke?o({},Me):{}},set current(e){Ue(e)},init:function(e){Ke=!0,Ue(e)},isStarted:function(){return Ke},toForeground:Ge,toBackground:function(){qe=!1},initParams:function(){ze(),Ge()},getParams:function(e){if(!Ke)return null;var t=Me.lastInterval>=0?Me.lastInterval:0,n={timeSpent:Me.timeSpent||0,sessionLength:Me.sessionLength||0,sessionCount:Me.sessionCount||1,lastInterval:t||0};return e&&N(e,"event")&&(n.eventCount=Me.eventCount),n},updateParams:function(e,t){if(Ke){var n={};n.timeSpent=Ye(),n.sessionLength=He(),N(e,"session")&&(n.sessionCount=(Me.sessionCount||0)+1),N(e,"event")&&(n.eventCount=(Me.eventCount||0)+1),Ve(n),t||Fe()}},updateInstalled:function(){Ke&&(Me.installed||Ve({installed:!0}))},updateSessionOffset:ze,updateSessionLength:function(){Ke&&(Ve({sessionLength:He()}),Fe())},resetSessionOffset:function(){Ke&&Ve({timeSpent:0,sessionLength:0})},updateLastActive:Fe,destroy:function(){Me={},Ke=!1,qe=!1},getAttribution:function(){return Ke?Me.attribution?Me.attribution:(Y.log("No attribution data yet"),null):null},getWebUUID:function(){return Ke?Me.uuid:null}};var Qe={},Xe=[];function Ze(e,t){var n="id"+Math.random().toString(36).substr(2,16),r={id:n,cb:t};return Qe[e]||(Qe[e]=[]),Qe[e].push(r),n}function $e(e,t){Qe[e]&&Qe[e].forEach((function(n){"function"==typeof n.cb&&Xe.push(setTimeout((function(){return n.cb(e,t)})))}))}var et=function(){function t(){Ee(this,t),e(this,"items",{})}return Te(t,[{key:"getItem",value:function(e){return Object.prototype.hasOwnProperty.call(this.items,e)?this.items[e]:null}},{key:"removeItem",value:function(e){delete this.items[e]}},{key:"setItem",value:function(e,t){this.items[e]=t}}]),t}();const tt=new(function(){function t(){var n=this;Ee(this,t),e(this,"defaultName",E.namespace),e(this,"storageName",this.defaultName),e(this,"storeNames",be.storeNames.left),e(this,"storesMap",void 0),e(this,"storage",void 0),this.storesMap={},C()?this.storage=window.localStorage:this.storage=new et;var r=this.read.bind(this),o=this.write.bind(this);A(this.storeNames).forEach((function(e){var t=e.name;Object.defineProperty(n.storesMap,t,{get:function(){return r(t)},set:function(e){o(t,e)}})})),Object.freeze(this.storesMap)}return Te(t,[{key:"read",value:function(e){var t=this.storage.getItem("".concat(this.storageName,".").concat(e)),n=t?JSON.parse(t):null;return e===oe.Preferences&&n?Ne(oe.Preferences,Pe.right,n):n}},{key:"write",value:function(e,t){t?this.storage.setItem("".concat(this.storageName,".").concat(e),JSON.stringify(t instanceof Array?t:Ne(oe.Preferences,Pe.left,t))):this.storage.removeItem("".concat(this.storageName,".").concat(e))}},{key:"clear",value:function(){this.deleteData()}},{key:"deleteData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];A(this.storeNames).forEach((function(n){!t&&n.permanent||e.storage.removeItem("".concat(e.storageName,".").concat(n.name))}))}},{key:"setCustomName",value:function(e){var t=this;if(e&&e.length){var n="".concat(E.namespace,"-").concat(e);A(this.storeNames).forEach((function(e){var r=e.name,o=t.storage.getItem("".concat(t.storageName,".").concat(r));o&&t.storage.setItem("".concat(n,".").concat(r),o)})),this.deleteData(!0),this.storageName=n}}},{key:"stores",get:function(){return this.storesMap}}]),t}());var nt=le.preferences.name,rt=ot();function ot(){return rt||it(),rt?o({},rt):null}function it(){rt=tt.stores[nt]}function at(){var e=ot();return e?e.sdkDisabled:null}function ut(e){var t=e?o({},e):null;tt.stores[nt]=o(o({},ot()),{},{sdkDisabled:t}),it()}function st(){var e=tt.stores[nt]||{},t=(rt||{}).sdkDisabled||null;e.sdkDisabled&&!t&&$e("sdk:shutdown"),it()}function ct(){tt.stores[nt]||(tt.stores[nt]=o({},rt))}var lt,ft,dt="undefined"==typeof Promise?n(702).Promise:Promise;!function(e){e.add="add",e.put="put",e.get="get",e.list="list",e.clear="clear",e.delete="delete"}(lt||(lt={})),function(e){e.readonly="readonly",e.readwrite="readwrite"}(ft||(ft={}));var vt=function(){function t(){Ee(this,t),e(this,"dbDefaultName",E.namespace),e(this,"dbName",this.dbDefaultName),e(this,"dbVersion",1),e(this,"idbFactory",void 0),e(this,"indexedDbConnection",null),e(this,"notSupportedError",{name:"IDBNotSupported",message:"IndexedDB is not supported"}),e(this,"databaseOpenError",{name:"CannotOpenDatabaseError",message:"Cannot open a database"}),e(this,"noConnectionError",{name:"NoDatabaseConnection",message:"Cannot open a transaction"});var n=t.getIndexedDB();if(!n)throw this.notSupportedError;this.idbFactory=n}return Te(t,[{key:"setCustomName",value:function(e){return e&&e.length>0?(this.dbName="".concat(E.namespace,"-").concat(e),this.migrateDb(this.dbDefaultName,this.dbName)):dt.resolve()}},{key:"openDatabase",value:function(e,n,r){var o=this;return t.isSupported().then((function(t){return t?new dt((function(t,i){var a=o.idbFactory.open(e,r);n&&(a.onupgradeneeded=function(e){return n(e,i)}),a.onsuccess=function(e){var n=e.target.result;n?t(n):i(o.databaseOpenError)},a.onerror=i})):dt.reject(o.notSupportedError)}))}},{key:"databaseExists",value:function(e){var t=this;return new dt((function(n){var r=!0;t.openDatabase(e,(function(){r=!1})).then((function(n){if(n.close(),!r)return t.deleteDatabaseByName(e)})).then((function(){return n(r)}))}))}},{key:"cloneData",value:function(e,t){var n=this;return A(be.storeNames.left).map((function(e){return e.name})).filter((function(e){return"p"!==e})).map((function(r){return function(){return o=r,i=n.indexedDbConnection,n.indexedDbConnection=e,n.getAll(o).then((function(e){if(n.indexedDbConnection=t,!(e.length<1))return n.addBulk(o,e,!0)})).then((function(){n.indexedDbConnection=i}));var o,i}})).reduce((function(e,t){return e.then(t)}),dt.resolve())}},{key:"migrateDb",value:function(e,t){var n=this;return this.databaseExists(e).then((function(r){return r?dt.all([n.openDatabase(e,n.handleUpgradeNeeded,n.dbVersion),n.openDatabase(t,n.handleUpgradeNeeded,n.dbVersion)]).then((function(t){var r=s(t,2),o=r[0],i=r[1];return n.cloneData(o,i).then((function(){return n.indexedDbConnection=i,o.close(),n.deleteDatabaseByName(e)}))})).then((function(){return Y.info("Database migration finished")})):n.openDatabase(t,n.handleUpgradeNeeded,n.dbVersion).then((function(e){n.indexedDbConnection=e}))}))}},{key:"handleUpgradeNeeded",value:function(e,t){var n=e.target.result;e.target.transaction.onerror=t,e.target.transaction.onabort=t;var r=be.storeNames.left,o=Je.current||{},i=o&&!k(o);I(r).filter((function(e){return!s(e,2)[1].permanent})).forEach((function(e){var t=s(e,2),r=t[0],a=t[1].name,u=be.right[r],c=n.createObjectStore(a,{keyPath:u.keyPath,autoIncrement:u.autoIncrement||!1});if(u.index&&c.createIndex("".concat(u.index,"Index"),u.index),a===re.ActivityState&&i)return c.add(Ne(r,Pe.left,o)),void Y.info("Activity state has been recovered");var l=tt.stores[a];l&&(l.forEach((function(e){return c.add(e)})),Y.info("Migration from localStorage done for ".concat(r," store")))})),ct(),tt.clear()}},{key:"open",value:function(){var e=this;return this.indexedDbConnection?dt.resolve({success:!0}):this.openDatabase(this.dbName,this.handleUpgradeNeeded,this.dbVersion).then((function(t){return e.indexedDbConnection=t,e.indexedDbConnection.onclose=function(){return e.destroy},{success:!0}}))}},{key:"getTransactionStore",value:function(e,t,n){var r,o=e.storeName,i=e.mode,a=n.transaction([o],i),u=a.objectStore(o),s=be.right[Oe(o,Pe.right)];return s.index&&(r=u.index("".concat(s.index,"Index"))),a.onerror=t,a.onabort=t,{transaction:a,store:u,index:r,options:s}}},{key:"overrideError",value:function(e,t){var n=t.target.error;return e({name:n.name,message:n.message})}},{key:"getCompositeKeys",value:function(e){var t=e.fields[e.keyPath];return se(t)?t.composite:null}},{key:"targetIsObject",value:function(e){return w(e)}},{key:"prepareTarget",value:function(t,n,r){if(r===lt.clear||!n)return null;var i=this.getCompositeKeys(t);return-1!==[lt.add,lt.put].indexOf(r)?this.targetIsObject(n)?i?o(e({},t.keyPath,i.map((function(e){return n[e]})).join("")),n):n:null:n instanceof Array?n.join(""):n}},{key:"prepareResult",value:function(e,t){var n=this.getCompositeKeys(e);return n&&this.targetIsObject(t)?n.map((function(e){return t[e]})):null}},{key:"initRequest",value:function(e){var t=this,n=e.storeName,r=e.target,o=void 0===r?null:r,i=e.action,a=e.mode,u=void 0===a?ft.readonly:a;return this.open().then((function(){return new dt((function(e,r){if(t.indexedDbConnection){var a=t.getTransactionStore({storeName:n,mode:u},r,t.indexedDbConnection),s=a.store,c=a.options,l=s[i](t.prepareTarget(c,o,i)),f=t.prepareResult(c,o);l.onsuccess=function(){i!==lt.get||l.result?e(f||l.result||o):r({name:"NotRecordFoundError",message:'Requested record not found in "'.concat(n,'" store')})},l.onerror=function(e){return t.overrideError(r,e)}}else r(t.noConnectionError)}))}))}},{key:"initBulkRequest",value:function(e){var t=this,n=e.storeName,r=e.target,o=e.action,i=e.mode,a=void 0===i?ft.readwrite:i;return!r||r&&!r.length?dt.reject({name:"NoTargetDefined",message:"No array provided to perform ".concat(o,' bulk operation into "').concat(n,'" store')}):this.open().then((function(){return new dt((function(e,i){if(t.indexedDbConnection){var u=t.getTransactionStore({storeName:n,mode:a},i,t.indexedDbConnection),s=u.transaction,c=u.store,l=u.options,f=new Array,d=r[0];s.oncomplete=function(){return e(f)};!function e(n){n.onerror=function(e){return t.overrideError(i,e)},n.onsuccess=function(){f.push(t.prepareResult(l,d)||n.result),d=r[f.length],f.length<r.length&&e(c[o](t.prepareTarget(l,d,o)))}}(c[o](t.prepareTarget(l,d,o)))}else i(t.noConnectionError)}))}))}},{key:"openCursor",value:function(e){var t=this,n=e.storeName,r=e.action,o=e.range,i=void 0===o?null:o,a=e.firstOnly,u=void 0!==a&&a,s=e.mode,c=void 0===s?ft.readonly:s;return this.open().then((function(){return new dt((function(e,o){if(t.indexedDbConnection){var a=t.getTransactionStore({storeName:n,mode:c},o,t.indexedDbConnection),s=a.transaction,l=a.store,f=a.index,d=a.options,v=(f||l).openCursor(i),p=new Array;s.oncomplete=function(){return e(p)},v.onsuccess=function(e){var n=e.target.result;n&&(r===lt.delete?(n.delete(),p.push(t.prepareResult(d,n.value)||n.value[d.keyPath])):p.push(n.value),u||n.continue())},v.onerror=function(e){return t.overrideError(o,e)}}else o(t.noConnectionError)}))}))}},{key:"deleteDatabaseByName",value:function(e){var t=this;return new dt((function(n,r){var o=t.idbFactory.deleteDatabase(e);o.onerror=function(e){return t.overrideError(r,e)},o.onsuccess=function(){return n()},o.onblocked=function(e){return r(e.target)}}))}},{key:"getAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.openCursor({storeName:e,action:lt.list,firstOnly:t})}},{key:"getFirst",value:function(e){return this.getAll(e,!0).then((function(e){return e.length?e[0]:void 0}))}},{key:"getItem",value:function(e,t){return this.initRequest({storeName:e,target:t,action:lt.get})}},{key:"filterBy",value:function(e,t){var n=IDBKeyRange.only(t);return this.openCursor({storeName:e,action:lt.list,range:n})}},{key:"addItem",value:function(e,t){return this.initRequest({storeName:e,target:t,action:lt.add,mode:ft.readwrite})}},{key:"addBulk",value:function(e,t,n){return this.initBulkRequest({storeName:e,target:t,action:n?lt.put:lt.add,mode:ft.readwrite})}},{key:"updateItem",value:function(e,t){return this.initRequest({storeName:e,target:t,action:lt.put,mode:ft.readwrite})}},{key:"deleteItem",value:function(e,t){return this.initRequest({storeName:e,target:t,action:lt.delete,mode:ft.readwrite})}},{key:"deleteBulk",value:function(e,t,n){var r=n?IDBKeyRange[n](t):IDBKeyRange.only(t);return this.openCursor({storeName:e,action:lt.delete,range:r,mode:ft.readwrite})}},{key:"trimItems",value:function(e,t){var n=this,r=be.right[Oe(e,Pe.right)];return this.getAll(e).then((function(e){return e.length?e[t-1]:null})).then((function(t){return t?n.deleteBulk(e,t[r.keyPath],Se.UpperBound):[]}))}},{key:"count",value:function(e){var t=this;return this.open().then((function(){return new dt((function(n,r){if(t.indexedDbConnection){var o=t.getTransactionStore({storeName:e,mode:ft.readonly},r,t.indexedDbConnection).store.count();o.onsuccess=function(){return n(o.result)},o.onerror=function(e){return t.overrideError(r,e)}}else r(t.noConnectionError)}))}))}},{key:"clear",value:function(e){return this.initRequest({storeName:e,action:lt.clear,mode:ft.readwrite})}},{key:"destroy",value:function(){this.indexedDbConnection&&this.indexedDbConnection.close(),this.indexedDbConnection=null}},{key:"deleteDatabase",value:function(){return this.destroy(),this.deleteDatabaseByName(this.dbName)}}],[{key:"tryOpen",value:function(e){return new dt((function(n){try{var r=e.open(t.dbValidationName);r.onsuccess=function(){r.result.close(),e.deleteDatabase(t.dbValidationName),n(!0)},r.onerror=function(){return n(!1)}}catch(e){n(!1)}}))}},{key:"isSupported",value:function(){if(t.isSupportedPromise)return t.isSupportedPromise;var e="IndexedDB is not supported in this browser";return t.isSupportedPromise=new dt((function(n){var r=t.getIndexedDB(),o=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);!r||o?(Y.warn(e),n(!1)):n(t.tryOpen(r).then((function(t){return t||Y.warn(e),t})))})),t.isSupportedPromise}},{key:"getIndexedDB",value:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB}}]),t}();e(vt,"dbValidationName","validate-db-openable"),e(vt,"isSupportedPromise",null);var pt="undefined"==typeof Promise?n(702).Promise:Promise,mt=function(){function t(){Ee(this,t)}return Te(t,[{key:"open",value:function(){return t.isSupported().then((function(e){if(!e)return{status:"error",error:{name:"LSNotSupported",message:"LocalStorage is not supported"}};var t=be.storeNames.left,n=Je.current||{},r=n&&!k(n);return I(t).filter((function(e){return!s(e,2)[1].permanent})).forEach((function(e){var t=s(e,2),o=t[0],i=t[1].name;i!==re.ActivityState||tt.stores[i]?tt.stores[i]||(tt.stores[i]=[]):tt.stores[i]=r?[Ne(o,Pe.left,n)]:[]})),ct(),{status:"success"}}))}},{key:"getCompositeKeys",value:function(e){var t=e.fields[e.keyPath];return se(t)?t.composite:null}},{key:"getKeys",value:function(e){var t=Oe(e,Pe.right),n=be.right[t];return this.getCompositeKeys(n)||[n.keyPath]}},{key:"nextIndex",value:function(e){return"number"==typeof e?e+1:void 0}},{key:"initRequest",value:function(e,t){var n=this,r=e.storeName,i=e.id,a=e.item,u=be.right[Oe(r,Pe.right)];return this.open().then((function(e){return"error"===e.status?pt.reject(e.error):new pt((function(e,s){var c,l=tt.stores[r],f=n.getKeys(r),d=(l[l.length-1]||{})[u.keyPath]||0;if(i){var v=Array.isArray(i)?i.slice():[i];c=f.map((function(e,t){return[e,v[t]]})).reduce(_,{})}else c=o({},a);var p=c?P(l,f,c):0;return t(e,s,{keys:f,items:l,index:p,options:u,lastId:d})}))}))}},{key:"sort",value:function(e,t,n){var r=c(e),o=t.slice().reverse();return r.sort((function(e,t){return o.reduce((function(r,o){return r||function(e,t,r){var o=n?n===e[r]:e[r]<t[r],i=n?n>e[r]:e[r]>t[r];return o?-1:i?1:0}(e,t,o)}),0)}))}},{key:"prepareTarget",value:function(t,n,r){var i=this.getCompositeKeys(t);return i?o(e({},t.keyPath,i.map((function(e){return n[e]})).join("")),n):t.autoIncrement&&r?o(e({},t.keyPath,r),n):o({},n)}},{key:"prepareResult",value:function(e,t){var n=this.getCompositeKeys(e);return n?n.map((function(e){return t[e]})).filter((function(e){return!xe(e)})):t[e.keyPath]}},{key:"getAll",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.open().then((function(r){return"error"===r.status?pt.reject(r.error):new pt((function(r,o){var i=tt.stores[e];i instanceof Array?r(n?[i[0]]:t.sort(i,t.getKeys(e))):o({name:"NotFoundError",message:"No objectStore named ".concat(e," in this database")})}))}))}},{key:"getFirst",value:function(e){return this.getAll(e,!0).then((function(e){return e.length?e[0]:void 0}))}},{key:"getItem",value:function(e,t){var n=this;return this.initRequest({storeName:e,id:t},(function(t,r,o){var i=o.items,a=o.index,u=o.options;-1===a?r({name:"NotRecordFoundError",message:'Requested record not found in "'.concat(e,'" store')}):t(n.prepareTarget(u,i[a]))}))}},{key:"filterBy",value:function(e,t){return this.getAll(e).then((function(n){return n.filter((function(n){var r=be.right[Oe(e,Pe.right)];return(r.index&&n[r.index])===t}))}))}},{key:"addItem",value:function(e,t){var n=this;return this.initRequest({storeName:e,item:t},(function(r,o,i){var a=i.items,u=i.index,s=i.options,c=i.lastId;-1!==u?o({name:"ConstraintError",message:'Constraint was not satisfied, trying to add existing item into "'.concat(e,'" store')}):(a.push(n.prepareTarget(s,t,n.nextIndex(c))),tt.stores[e]=a,r(n.prepareResult(s,t)))}))}},{key:"addBulk",value:function(e,t,n){var r=this;return this.initRequest({storeName:e},(function(o,i,a){var u=a.keys,s=a.items,l=a.options,f=a.lastId;if(!t||t&&!t.length)i({name:"NoTargetDefined",message:'No array provided to perform add bulk operation into "'.concat(e,'" store')});else{var d=f,v=t.map((function(e){return r.prepareTarget(l,e,d=r.nextIndex(d))})),p=v.filter((function(e){return-1!==P(s,u,e)})).map((function(e){return e[l.keyPath]})),m=n?s.filter((function(e){return-1===p.indexOf(e[l.keyPath])})):c(s);if(p.length&&!n)i({name:"ConstraintError",message:'Constraint was not satisfied, trying to add existing items into "'.concat(e,'" store')});else tt.stores[e]=r.sort([].concat(c(m),c(v)),u),o(t.map((function(e){return r.prepareResult(l,e)})))}}))}},{key:"updateItem",value:function(e,t){var n=this;return this.initRequest({storeName:e,item:t},(function(r,o,i){var a=i.items,u=i.index,s=i.options,c=i.lastId,l=-1===u?n.nextIndex(c):void 0,f=n.prepareTarget(s,t,l);-1===u?a.push(f):a.splice(u,1,f),tt.stores[e]=a,r(n.prepareResult(s,t))}))}},{key:"deleteItem",value:function(e,t){return this.initRequest({storeName:e,id:t},(function(n,r,o){var i=o.items,a=o.index;-1!==a&&(i.splice(a,1),tt.stores[e]=i),n(t)}))}},{key:"findMax",value:function(e,t,n){if(!e.length)return-1;for(var r={index:-1,value:"string"==typeof n?"":0},o=0;o<e.length;o+=1){if(!(e[o][t]<=n))return r.index;e[o][t]>=r.value&&(r={value:e[o][t],index:o})}return r.index}},{key:"deleteBulk",value:function(e,t,n){var r=this;return this.getAll(e).then((function(o){var i=r.getKeys(e),a=be.right[Oe(e,Pe.right)].index||i[0],u=n?null:t,s=r.sort(o,i,u),c=r.findMax(s,a,t);if(-1===c)return[];var l=n===Se.LowerBound?c:0,f=n&&n!==Se.UpperBound?s.length:c+1,d=s.splice(l,f).map((function(e){return 1===i.length?e[a]:i.map((function(t){return e[t]}))}));return tt.stores[e]=s,d}))}},{key:"trimItems",value:function(e,t){var n=this,r=Oe(e,Pe.right),o=be.right[r];return this.getAll(e).then((function(e){return e.length?e[t-1]:null})).then((function(t){return t?n.deleteBulk(e,t[o.keyPath],Se.UpperBound):[]}))}},{key:"count",value:function(e){return this.open().then((function(t){if("error"===t.status)return pt.reject(t.error);var n=tt.stores[e];return pt.resolve(n instanceof Array?n.length:1)}))}},{key:"clear",value:function(e){return this.open().then((function(t){return"error"===t.status?pt.reject(t.error):new pt((function(t){tt.stores[e]=[],t()}))}))}},{key:"destroy",value:function(){}},{key:"deleteDatabase",value:function(){}}],[{key:"isSupported",value:function(){return t.isSupportedPromise||(t.isSupportedPromise=new pt((function(e){var t=C();t||Y.warn("LocalStorage is not supported in this browser"),e(t)}))),t.isSupportedPromise}}]),t}();e(mt,"isSupportedPromise",null);var ht,gt="undefined"==typeof Promise?n(702).Promise:Promise;!function(e){e[e.noStorage=h]="noStorage",e[e.indexedDB=g]="indexedDB",e[e.localStorage=y]="localStorage"}(ht||(ht={}));var yt,bt={getAll:function(e,t,n){return e.getAll(t,n).then((function(e){return _e(t,Pe.right,e)}))},getFirst:function(e,t){return e.getFirst(t).then((function(e){return Ne(t,Pe.right,e)}))},getItem:function(e,t,n){return e.getItem(t,Ie(t,Pe.left,n)).then((function(e){return Ne(t,Pe.right,e)})).catch((function(e){return gt.reject(Ce(t,e))}))},filterBy:function(e,t,n){return e.filterBy(t,Ae(n)).then((function(e){return _e(t,Pe.right,e)}))},addItem:function(e,t,n){var r=Ne(t,Pe.left,n);return e.addItem(t,r).then((function(e){return Ie(t,Pe.right,e)})).catch((function(e){return gt.reject(Ce(t,e))}))},addBulk:function(e,t,n,r){var o=_e(t,Pe.left,n);return e.addBulk(t,o,r).then((function(e){return e.map((function(e){return Ie(t,Pe.right,e)}))})).catch((function(e){return gt.reject(Ce(t,e))}))},updateItem:function(e,t,n){var r=Ne(t,Pe.left,n);return e.updateItem(t,r).then((function(e){return Ie(t,Pe.right,e)}))},deleteItem:function(e,t,n){return e.deleteItem(t,Ie(t,Pe.left,n)).then((function(e){return Ie(t,Pe.right,e)}))},deleteBulk:function(e,t,n,r){return e.deleteBulk(t,Ae(n),r).then((function(e){return e.map((function(e){return Ie(t,Pe.right,e)}))}))},trimItems:function(e,t,n){return e.trimItems(t,n)},count:function(e,t){return e.count(t)},clear:function(e,t){return e.clear(t)},destroy:function(e){return e.destroy()},deleteDatabase:function(e){return e.deleteDatabase()}};var kt=null;function wt(e){var t=null;return null!==kt?kt:kt=gt.all([vt.isSupported(),mt.isSupported()]).then((function(n){var r=s(n,2),o=r[0],i=r[1];if(tt.setCustomName(e),o){yt=ht.indexedDB;var a=new vt;return a.setCustomName(e).then((function(){return t=a}))}return i?(yt=ht.localStorage,t=new mt,gt.resolve(t)):(Y.error("There is no storage available, app will run with minimum set of features"),yt=ht.noStorage,t=null,gt.resolve(t))})).then((function(){return{type:yt,storage:t}}))}const St=o({init:wt,getType:function(){return yt}},(Pt=I(bt).map((function(e){var t=s(e,2),n=t[0],r=t[1];return[n,function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return wt().then((function(t){var o=t.storage;if(o)return r.call.apply(r,[null,o,Oe(e,Pe.left)].concat(n))}))}]})),Pt.reduce(_,{})));var Pt;"undefined"==typeof Promise&&n(702).Promise;function xt(){return St.getAll("queue").then((function(e){return{queueSize:e.length}})).then((function(e){return o(o(o(o(o(o(o(o({},{createdAt:Be()}),{sentAt:Be()}),{webUuid:Je.current.uuid}),(n=navigator,r=void 0!==n.doNotTrack,i=void 0!==window.doNotTrack,a=void 0!==n.msDoNotTrack,u=r?n.doNotTrack:i?window.doNotTrack:a?n.msDoNotTrack:null,0===parseInt(u,10)||"no"===u?{trackingEnabled:!0}:1===parseInt(u,10)||"yes"===u?{trackingEnabled:!1}:null)),{platform:"web"}),function(){var e=navigator,t=s((e.language||e.userLanguage||"en").split("-"),2),n=t[0],r=t[1];return{language:n,country:r?""+r.toLowerCase():void 0}}()),(t=navigator.userAgent||navigator.vendor,{machineType:"Win32"!==navigator.platform||-1===t.indexOf("WOW64")&&-1===t.indexOf("Win64")?navigator.platform:"Win64"})),e);var t,n,r,i,a,u}))}var Dt="undefined"==typeof Promise?n(702).Promise:Promise;function Nt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{status:"error",action:n?"CONTINUE":"RETRY",response:S(e.responseText)?JSON.parse(e.responseText):e.responseText,message:m[t],code:t}}function _t(e,t){var n=e.slice(0,e.length-t.length-1).split("").reduce((function(e){return e.concat(" ")}),"");return"".concat(t).concat(n,":")}function It(e,t){var n="REQUEST PARAMETERS:",r=function(e){return e.replace(/([A-Z])/g,(function(e){return"_".concat(e.toLowerCase())}))},i=I(o(o(o({},$.getBaseParams()),t),e)).map((function(e){var t=s(e,2),n=t[0],o=t[1];return[r(n),o]}));return Y.log(n),i.filter((function(e){return O(s(e,2)[1])})).map((function(e){var t=s(e,2),r=t[0],o=t[1];return Y.log(_t(n,r),o),function(e){var t=s(e,2),n=t[0],r=t[1],o=encodeURIComponent(n),i=r;return"string"==typeof r&&(i=encodeURIComponent(r)),w(r)&&(i=encodeURIComponent(JSON.stringify(r)||"")),[o,i].join("=")}([r,o])})).join("&")}function At(e,t,n){var r=n.xhr,o=n.url;if(4===r.readyState){var i=r.status>=200&&r.status<300,a=S(r.responseText);if(0!==r.status)return a?t(i?function(e,t){var n=JSON.parse(e.responseText),r={status:"success",adid:n.adid,timestamp:n.timestamp,ask_in:n.ask_in,retry_in:n.retry_in,continue_in:n.continue_in,tracking_state:n.tracking_state,attribution:void 0,message:void 0};return N(t,"attribution")&&(r.attribution=n.attribution,r.message=n.message),I(r).filter((function(e){return!!s(e,2)[1]})).reduce(_,{})}(r,o):Nt(r,"SERVER_CANNOT_PROCESS",!0)):e(Nt(r,i?"SERVER_MALFORMED_RESPONSE":"SERVER_INTERNAL_ERROR"));e(Nt(r,"NO_CONNECTION"))}}function Ot(e,t){var n=e.endpoint,r=e.url,o=e.method,i=void 0===o?"GET":o,a=e.params,u=function(e,t){var n=e.endpoint,r=e.url,o=e.method,i=It(e.params,t);return{fullUrl:n+r+("GET"===o?"?".concat(i):""),encodedParams:i}}({endpoint:n,url:r,method:i,params:void 0===a?{}:a},t),c=u.fullUrl,l=u.encodedParams;return new Dt((function(e,t){var n=new XMLHttpRequest;n.open(i,c,!0),function(e,t){var n="REQUEST HEADERS:",r=[["Client-SDK","js".concat(E.version)],["Content-Type","POST"===t?"application/x-www-form-urlencoded":"application/json"]];Y.log(n),r.forEach((function(t){var r=s(t,2),o=r[0],i=r[1];e.setRequestHeader(o,i),Y.log(_t(n,o),i)}))}(n,i),n.onreadystatechange=function(){return At(t,e,{xhr:n,url:r})},n.onerror=function(){return t(Nt(n,"TRANSACTION_ERROR"))},n.send("GET"===i?void 0:l)}))}function Ct(e,t){return"success"===e.status?function(e,t){var n=N(t,"gdpr_forget_device"),r=N(t,"attribution"),o=N(t,"session"),i=N(t,"disable_third_party_sharing"),a="opted_out"===e.tracking_state;if(!n&&a)return $e("sdk:gdpr-forget-me"),e;r||n||a||!e.ask_in||$e("attribution:check",e);o&&$e("session:finished",e);if(i)return $e("sdk:third-party-sharing-opt-out"),e;return e}(e,t):e}function Et(e){return xt().then((function(t){return Ot(e,t)})).then((function(t){return Ct(t,e.url)}))}var Rt={long:{delay:12e4,maxDelay:d,minRange:.5,maxRange:1},short:{delay:200,maxDelay:f,minRange:.5,maxRange:1},test:{delay:100,maxDelay:300}};function Tt(e,t){var n,r,o=Rt[t=t||"long"],i=o.delay*Math.pow(2,e-1);return i=Math.min(i,o.maxDelay),o.minRange&&o.maxRange&&(i*=(n=o.minRange,r=o.maxRange,Math.random()*(r-n)+n)),Math.round(i)}var jt,Bt=navigator.onLine;function Lt(){Bt=!0}function Mt(){Bt=!1}function Kt(e,t,n){e.addEventListener&&e.addEventListener(t,n,!1)}function qt(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}function Ut(){return Bt}function Ft(e,t){Y.warn("Both ".concat(e," and ").concat(t," are set in config, ").concat(t," will be ignored"))}!function(e){e.Default="default"}(jt||(jt={}));var Vt=e({},jt.Default,{endpointName:"Default",app:"https://app.adtrace.io",gdpr:"https://gdpr.adtrace.io"});function Gt(e){var t,n,r,o,i=(t=$.getCustomConfig(),n=t.customUrl,r=t.urlStrategy,o=t.dataResidency,n?((o||r)&&Ft("customUrl",o?"dataResidency":"urlStrategy"),{app:n,gdpr:n}):(o&&r&&Ft("dataResidency","urlStrategy"),o?[o]:[jt.Default]));return Array.isArray(i)?i.map((function(t){return e[t]||null})).filter((function(e){return!!e})):[i]}function Wt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vt,t=Gt(e),n=0;return{next:function(){return n<t.length?{value:t[n++],done:!1}:{value:void 0,done:!0}},reset:function(){n=0}}}var Yt="undefined"==typeof Promise?n(702).Promise:Promise,Ht=150,zt=2147483647,Jt=6e4;const Qt=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.url,i=n.method,a=void 0===i?"GET":i,u=n.params,c=void 0===u?{}:u,l=n.continueCb,f=n.strategy,d=n.wait,v={url:r,method:a,params:c,continueCb:l},p=r,h=a,g=o({},c),y=l,b=f,w=function(){e.reset(),t=e.next()},S=function(e,t){return e["/gdpr_forget_device"===t?"gdpr":"app"]},P=null,x={request:0,connection:0},D=A(d),N=null;function A(e){return(e=e||Ht)>zt?zt:e}function C(e){var t=e.url,n=e.method,r=e.params,i=e.continueCb;t&&(p=t),n&&(h=n),k(r)||(g=o({},r)),g=o({createdAt:Be()},g),"function"==typeof i&&(y=i)}function E(e){if(!N)return!1;if(P){var t=D-(Date.now()-N);if(e&&t<e)return!0;G()}return!1}function R(n){var r=n.wait,i=n.retrying;return e||(e=Wt(),t=e.next()),D=r?A(r):D,E(r)?Yt.resolve({status:"error",action:"CONTINUE",response:"",message:m.SKIP,code:"SKIP"}):p?(Y.log("".concat(i?"Re-trying":"Trying"," request ").concat(p," in ").concat(D,"ms")),N=Date.now(),T({endpoint:S(t.value,p),url:p,method:h,params:o({attempts:1},g)})):(Y.error("You must define url for the request to be sent"),Yt.reject({status:"error",action:"CONTINUE",response:"",message:m.MISSING_URL,code:"MISSING_URL"}))}function T(e){return V(),Ut()?j(e):(x.connection+=1,Y.log("No internet connectivity, trying request ".concat(e.url," in ").concat(Jt,"ms")),new Yt((function(t){P=setTimeout((function(){t(T(e))}),Jt)})))}function j(e){return new Yt((function(t,n){P=setTimeout((function(){N=null;var r=I(e.params).filter((function(e){return O(s(e,2)[1])})).reduce(_,{});return Et({endpoint:e.endpoint,url:e.url,method:e.method,params:o(o({},r),{},{attempts:(x.request?x.request+1:1)+x.connection})}).then((function(e){return K(e,t)})).catch((function(e){return q(e,t,n)}))}),D)}))}function B(){p=v.url,h=v.method,g=o({},v.params),y=v.continueCb}function L(e){Y.log("Request ".concat(p||"unknown"," ").concat(e?"failed":"has been finished")),x.request=0,x.connection=0,D=Ht,B(),G()}function M(e){return x.request+=1,G(),R({wait:e||Tt(x.request,b),retrying:!0})}function K(e,t){e&&e.retry_in?t(M(e.retry_in)):(w(),"function"==typeof y?y(e,L,M):L(),t(e))}function q(n,r,o){if(n&&"RETRY"===n.action)if("NO_CONNECTION"===n.code){var i=e.next();i.done?(w(),r(M(Jt))):(t=i,r(M(Ht)))}else r(M());else L(!0),o(n||{})}function U(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n=e.method,r=e.params,o=void 0===r?{}:r,i=e.continueCb,a=e.wait;return C({url:t,method:n,params:o,continueCb:i}),R({wait:a})}function F(){return!!P}function V(){P&&clearTimeout(P),P=null}function G(){var e=!!N;V(),N=null,e&&(D=Ht,x.request=0,x.connection=0,Y.log("Previous ".concat(p||"unknown"," request attempt canceled")),B())}return{send:U,isRunning:F,clear:G}};var Xt=function(e){return e===p?"GDPR disable":"disable"},Zt=function(e){return{start:{inProgress:"Adtrace SDK ".concat(Xt(e)," process has already started"),done:"Adtrace SDK ".concat(Xt(e)," process is now started")},finish:{inProgress:"Adtrace SDK ".concat(Xt(e)," process has already finished"),done:"Adtrace SDK ".concat(Xt(e)," process is now finished")}}};function $t(e,t){var n=e.reason,r=e.pending,o=at()||{},i="start"===t&&o.pending?"start":"finish",a="start"===t&&o.reason,u="finish"===t&&o.reason&&!o.pending;return a||u?(Y.log(Zt(o.reason)[i].inProgress),!1):(Y.log(Zt(n)[i].done),ut({reason:n||v,pending:r}),!0)}function en(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return $t({reason:e,pending:t||!1},"start")}function tn(){var e=at()||{};return e.reason===v||e.reason===p&&!e.pending?"off":e.reason===p&&e.pending?"paused":"on"}var nn="undefined"==typeof Promise?n(702).Promise:Promise,rn="activityState",on=!1;function an(e){return e?"unknown"===e.uuid?(en({reason:p}),Je.destroy(),{exists:!0,stored:null}):(Je.init(e),{exists:!0,stored:e}):{exists:!1}}function un(){return"off"!==tn()&&Je.isStarted()}function sn(){if(!un())return nn.resolve(null);var e=o(o({},Je.current),{},{lastActive:Date.now()});return St.updateItem(rn,e).then((function(){return Je.current=e}))}var cn="undefined"==typeof Promise?n(702).Promise:Promise,ln=Qt({strategy:"long",continueCb:function(e,t){var n=e&&e.continue_in||null;return vn.pause=n?{timestamp:Date.now(),wait:n}:null,St.getFirst(dn).then((function(e){return e?St.deleteItem(dn,e.timestamp):null})).then((function(){return t(),vn.running=!1,bn({wait:n})}))}}),fn=!1,dn="queue",vn={running:!1,timestamp:null,pause:null};function pn(){var e=Date.now();return vn.timestamp&&e<=vn.timestamp&&(e=vn.timestamp+1),vn.timestamp=e,e}function mn(e){return N(e,"session")&&Je.resetSessionOffset(),Je.updateLastActive(),sn()}function hn(e){var t=e.url,n=e.method,r=e.params,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.auto,u=i.timestamp;Je.updateParams(t,a);var c=I(r||{}).filter((function(e){return O(s(e,2)[1])})).reduce(_,{}),l={timestamp:pn(),url:t,method:n,params:o(o({},Je.getParams(t)),c)};return u&&(l.createdAt=u),St.addItem(dn,l).then((function(){return mn(t)})).then((function(){return vn.running?{}:bn()}))}function gn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.timestamp,n=e.createdAt,r=e.url,i=e.method,a=e.params,u=arguments.length>1?arguments[1]:void 0,s=Je.current||{},c="/session"===r&&!s.installed,l=!r&&!i&&!a;return fn&&!c||l?(vn.running=!1,cn.resolve({})):ln.send({url:r,method:i,params:o(o({},a),{},{createdAt:Be(n||t)}),wait:u||yn()})}function yn(){var e=vn.pause||{},t=e.timestamp,n=e.wait,r=Date.now()-(t||0);return r<n?n-r:null}function bn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cleanUp,n=e.wait;if(vn.running)return cn.resolve({});vn.running=!0;var r=cn.resolve({});return t&&(r=r.then(wn)),r.then((function(){return St.getFirst(dn)})).then((function(e){return gn(e,n)}))}function kn(e){if(void 0!==e)if(e!==fn){var t=fn;fn=e,!e&&t&&bn(),Y.info("The app is now in ".concat(e?"offline":"online"," mode"))}else Y.error("The app is already in ".concat(e?"offline":"online"," mode"));else Y.error("State not provided, true or false has to be defined")}function wn(){var e=Date.now()-$.requestValidityWindow;return St.deleteBulk(dn,e,"upperBound")}var Sn="undefined"==typeof Promise?n(702).Promise:Promise,Pn="globalParams",xn="No type provided",Dn="Global parameter type not provided, `callback` or `value` types are available";function Nn(e){return(e||[]).map((function(e){return{key:e.key,value:e.value}}))}function _n(){return Sn.all([St.filterBy(Pn,"callback"),St.filterBy(Pn,"value")]).then((function(e){var t=s(e,2),n=t[0],r=t[1];return{callbackParams:Nn(n),eventValueParams:Nn(r)}}))}function In(e,t){if(void 0===t)return Y.error(Dn),Sn.reject({message:xn});var n=x(e),r=Object.keys(n).map((function(e){return{key:e,value:n[e],type:t}}));return Sn.all([St.filterBy(Pn,t),St.addBulk(Pn,r,!0)]).then((function(e){var n=s(e,2),o=n[0],i=n[1],a=D(o.map((function(e){return e.key})),i.map((function(e){return e[0]})));return Y.log("Following ".concat(t," parameters have been saved: ").concat(r.map((function(e){return"".concat(e.key,":").concat(e.value)})).join(", "))),a.length&&Y.log("Keys: ".concat(a.join(", ")," already existed so their values have been updated")),i}))}function An(e,t){return void 0===t?(Y.error(Dn),Sn.reject({message:xn})):St.deleteItem(Pn,[e,t]).then((function(n){return Y.log("".concat(e," ").concat(t," parameter has been deleted")),n}))}function On(e){return void 0===e?(Y.error(Dn),Sn.reject({message:xn})):St.deleteBulk(Pn,e).then((function(t){return Y.log("All ".concat(e," parameters have been deleted")),t}))}var Cn,En,Rn,Tn="undefined"==typeof Promise?n(702).Promise:Promise,jn=!1,Bn=document;function Ln(){return Rn=function(){var e=document;if(void 0!==e.hidden)return{hidden:"hidden",visibilityChange:"visibilitychange"};for(var t=I({mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange",webkitHidden:"webkitvisibilitychange"}),n=0;n<t.length;n+=1){var r=s(t[n],2),o=r[0],i=r[1];if(void 0!==e[o])return{hidden:o,visibilityChange:i}}return null}(),jn?Tn.reject({interrupted:!0,message:"Session watch already initiated"}):(jn=!0,Ze("session:finished",Fn),Rn&&Kt(Bn,Rn.visibilityChange,qn),Rn&&Bn[Rn.hidden]?(Y.log("Session request attempt canceled because the tab is still hidden"),Tn.resolve({})):(Je.initParams(),Gn()))}function Mn(){return Vn(),Je.updateSessionOffset(),Je.toBackground(),sn()}function Kn(){return St.getFirst(rn).then((function(e){var t=Je.current,n=t.lastActive||0;if(un()&&n<e.lastActive){var r=!t.installed&&e.installed,o=(t.sessionCount||0)<(e.sessionCount||0);(r||o)&&$e("sdk:installed"),Je.current=e,st()}return e})).then((function(){Je.updateSessionLength(),Je.toForeground()})).then(Gn)}function qn(){clearTimeout(En);var e=Rn&&Bn[Rn.hidden]?Mn:Kn;En=setTimeout(e,0)}function Un(){Rn&&!Bn[Rn.hidden]&&(st(),jn||"on"!==tn()||(qt(Bn,Rn.visibilityChange,Un),hr.__internal__.restartAfterAsyncEnable()))}function Fn(e,t){if(!t||"error"!==t.status)return Je.updateInstalled(),$e("sdk:installed"),sn();Y.error("Session was not successful, error was returned from the server:",t.response)}function Vn(){clearInterval(Cn)}function Gn(){Vn(),Cn=setInterval((function(){return Je.updateSessionOffset(),sn()}),$.sessionTimerWindow);var e=Je.current,t=e.lastInterval,n=e.sessionCount>0;return!n||n&&t*l>=$.sessionWindow?_n().then((function(e){var t,n,r;hn({url:"/session",method:"POST",params:(t=e,n=t.callbackParams,r=t.eventValueParams,{callbackParams:n.length?x(n):null,valueParams:r.length?x(r):null})},{auto:!0})})):($e("attribution:check"),sn())}var Wn="undefined"==typeof Promise?n(702).Promise:Promise,Yn=Qt({url:"/attribution",strategy:"short",continueCb:function(e,t,n){if(!e||e&&"error"===e.status)return t(),Wn.resolve({state:"unknown"});if(!e.ask_in)return t(),function(e){if(k(e)||!function(e){var t=e.adid,n=void 0===t?"":t,r=e.attribution,o=void 0===r?{}:r;return!!n&&!!D(Hn,Object.keys(o)).length}(e)||function(e){var t=e.adid,n=e.attribution,r=Je.current.attribution||{};return!(n&&Hn.some((function(e){return r[e]!==n[e]})))&&t===r.adid}(e))return Wn.resolve({state:"same"});var t=I(e.attribution).filter((function(e){var t=s(e,1)[0];return-1!==Hn.indexOf(t)})).reduce(_,{adid:e.adid});return Je.current=o(o({},Je.current),{},{attribution:t}),sn().then((function(){return $e("attribution:change",t),Y.info("Attribution has been updated"),{state:"changed"}}))}(e);return n(e.ask_in)}}),Hn=["tracker_token","tracker_name","network","campaign","adgroup","creative","click_label","state"];var zn=[];function Jn(e,t){zn.push({method:e,description:t,timestamp:Date.now()})}var Qn="undefined"==typeof Promise?n(702).Promise:Promise,Xn="eventDeduplication";function Zn(e,t){var n,r,i=t.callbackParams,a=t.eventValueParams,u={},s=o({eventToken:e.eventToken,deduplicationId:e.deduplicationId},(n=e.revenue,r=e.currency,isNaN(n)||(n=parseFloat(n))<0||!r?{}:{revenue:n.toFixed(5),currency:r})),c=o(o({},x(i)),x(e.callbackParams)),l=o(o({},x(a)),x(e.eventValueParams));return k(c)||(u.callbackParams=c),k(a)||(u.eventValueParams=l),o(o({},s),u)}function $n(e){return e?St.getAll(Xn).then((function(e){return e.map((function(e){return e.id}))})).then((function(t){return-1===t.indexOf(e)?function(e){var t=$.getCustomConfig().eventDeduplicationListLimit,n=t>0?t:10;return St.count(Xn).then((function(e){var t=Qn.resolve();if(e>=n){var r=e-n+1;Y.log("Event deduplication list limit has been reached. Oldest ids are about to be removed (".concat(r," of them)")),t=St.trimItems(Xn,r)}return t})).then((function(){return Y.info("New event deduplication id is added to the list: ".concat(e)),St.addItem(Xn,{id:e})}))}(e):Qn.reject({message:"Event won't be tracked, since it was previously tracked with the same deduplication id ".concat(e)})})):Qn.resolve()}function er(e){return{clickTime:Be(),source:"web_referrer",referrer:decodeURIComponent(e)}}function tr(e,t){var n;(n=e||window.location.search.substring(1).split("&").map((function(e){return e.split("=")})).reduce(_,{}).adtrace_referrer)&&hn({url:"/sdk_click",method:"POST",params:er(n)},{timestamp:t})}var nr=["logLevel","logOutput"],rr="undefined"==typeof Promise?n(702).Promise:Promise,or=null,ir=!1,ar=!1,ur=!1;function sr(){return ir||$.isInitialised()}function cr(){ir=!1,ar=!1,zn=[],ln.clear(),vn.running=!1,vn.timestamp=null,vn.pause=null,jn=!1,Je.toBackground(),Vn(),Rn&&(clearTimeout(En),qt(Bn,Rn.visibilityChange,qn),Kt(Bn,Rn.visibilityChange,Un)),Yn.clear()}function lr(e){e&&Y.log("Adtrace SDK has been shutdown due to asynchronous disable"),cr(),Xe.forEach(clearTimeout),Xe=[],Qe={},Je.destroy(),qt(window,"online",Lt),qt(window,"offline",Mt),St.destroy(),$.destroy()}function fr(e){Y.log("Adtrace SDK is starting with web_uuid set to ".concat(e.uuid));var t=Je.current.installed,n=tn(),r=function(e){return"Adtrace SDK start has been interrupted ".concat(e)};return"off"===n?(lr(),rr.reject({interrupted:!0,message:r("due to complete async disable")})):"paused"===n?(cr(),rr.reject({interrupted:!0,message:r("due to partial async disable")})):ar?rr.reject({interrupted:!0,message:r("due to multiple synchronous start attempt")}):(bn({cleanUp:!0}),Ln().then((function(){ir=!1,ar=!0,t&&dr()})))}function dr(){var e;ur=!0,zn.forEach((function(e){"function"==typeof e.method&&(Y.log("Delayed ".concat(e.description," task is running now")),e.method(e.timestamp))})),zn=[],(e="sdk:installed")&&I(Qe).some((function(t){var n=s(t,2)[1];return n.some((function(t,r){if(t.id===e)return n.splice(r,1),!0}))}))}function vr(e){if(e.interrupted)Y.log(e.message);else if(lr(),Y.error("Adtrace SDK start has been canceled due to an error",e),e.stack)throw e}function pr(e){"off"!==tn()?($.set(e),Kt(window,"online",Lt),Kt(window,"offline",Mt),Ze("sdk:installed",dr),Ze("sdk:shutdown",(function(){return lr(!0)})),Ze("attribution:check",(function(e,t){return n=t,r=Je.current,(i=(n||{}).ask_in)||!r.attribution&&r.installed?(Yn.send({params:o({initiatedBy:n?"backend":"sdk"},Je.getParams()),wait:i}),Je.updateSessionOffset(),sn()):Wn.resolve(r);var n,r,i})),"function"==typeof e.attributionCallback&&Ze("attribution:change",e.attributionCallback),(on?nn.reject({interrupted:!0,message:"Adtrace SDK start already in progress"}):(on=!0,St.getFirst(rn).then(an).then((function(e){if(e.exists)return on=!1,e.stored;var t,n=k(Je.current)?{uuid:(t=Date.now(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:11&n).toString(16)})))}:Je.current;return St.addItem(rn,n).then((function(){return Je.init(n),st(),on=!1,n}))})))).then(fr).then(tr).catch(vr)):Y.log("Adtrace SDK is disabled, can not start the sdk")}function mr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.schedule,o=n.waitForInitFinished,i=n.optionalInit;if(St.getType()!==h)if("on"===tn())if(i||sr()||!o){if("function"==typeof t){if(!r||ur&&ar||!i&&!sr())return t();Jn(t,e),Y.log("Running ".concat(e," is delayed until Adtrace SDK is up"))}}else Y.error("Adtrace SDK can not ".concat(e,", sdk instance is not initialized"));else Y.log("Adtrace SDK is disabled, can not ".concat(e));else Y.log("Adtrace SDK can not ".concat(e,", no storage available"))}const hr={initSdk:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.logLevel,n=e.logOutput,r=i(e,nr);Y.setLogLevel(t,n),sr()?Y.error("You already initiated your instance"):$.hasMissing(r)||(ir=!0,St.init(r.namespace).then((function(e){e.type!==h?(Y.info("Available storage is ".concat(e.type)),or=o({},r),pr(r)):Y.error("Adtrace SDK can not start, there is no storage available")})))},getAttribution:function(){return mr("get attribution",(function(){return Je.getAttribution()}))},getWebUUID:function(){return mr("get web_uuid",(function(){return Je.getWebUUID()}))},setReferrer:function(e){e&&"string"==typeof e?mr("setting reftag",(function(t){return tr(e,t)}),{schedule:!0,waitForInitFinished:!0,optionalInit:!0}):Y.error("You must provide a string referrer")},trackEvent:function(e){return function(e){if(St.getType()===h){var t="Adtrace SDK can not track event, no storage available";return Y.log(t),rr.reject(t)}if("on"!==tn()){var n="Adtrace SDK is disabled, can not track event";return Y.log(n),rr.reject(n)}if(!sr()){var r="Adtrace SDK can not track event, sdk instance is not initialized";return Y.error(r),rr.reject(r)}return new rr((function(t){var n=function(n){return t(function(e,t){if(!e||e&&(k(e)||!e.eventToken)){var n="You must provide event token in order to track event";return Y.error(n),Qn.reject(n)}return $n(e.deduplicationId).then(_n).then((function(n){return hn({url:"/event",method:"POST",params:Zn(e,n)},{timestamp:t})})).catch((function(e){return e&&e.message&&Y.error(e.message),Qn.reject(e)}))}(e,n))};!ur||!ar&&sr()?(Jn(n,"track event"),Y.log("Running track event is delayed until Adtrace SDK is up")):n()}))}(e)},addGlobalCallbackParameters:function(e){mr("add global callback parameters",(function(){return In(e,"callback")}))},addGlobalValueParameters:function(e){mr("add global value parameters",(function(){return In(e,"value")}))},removeGlobalCallbackParameter:function(e){mr("remove global callback parameter",(function(){return An(e,"callback")}))},removeGlobalValueParameter:function(e){mr("remove global value parameter",(function(){return An(e,"value")}))},clearGlobalCallbackParameters:function(){mr("remove all global callback parameters",(function(){return On("callback")}))},clearGlobalValueParameters:function(){mr("remove all global value parameters",(function(){return On("value")}))},switchToOfflineMode:function(){mr("set offline mode",(function(){return kn(!0)}))},switchBackToOnlineMode:function(){mr("set online mode",(function(){return kn(!1)}))},stop:function(){en()&&$.isInitialised()&&lr()},restart:function(){var e;((e=at()||{}).reason===p?(Y.log("Adtrace SDK is disabled due to GDPR-Forget-Me request and it can not be re-enabled"),!1):e.reason?(Y.log("Adtrace SDK has been enabled"),ut(null),!0):(Y.log("Adtrace SDK is already enabled"),!1))&&or&&pr(or)},__testonly__:{destroy:function(){ur=!1,lr(),or=null,Y.log("Adtrace SDK instance has been destroyed")},clearDatabase:function(){return St.deleteDatabase()}},__internal__:{restartAfterAsyncEnable:function(){Y.log("Adtrace SDK has been restarted due to asynchronous enable"),or&&pr(or)}}}})(),r=r.default})()));
