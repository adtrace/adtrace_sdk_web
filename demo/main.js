/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={702:function(e,t,n){e.exports=function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,i=void 0,a=void 0,u=function(e,t){k[o]=e,k[o+1]=t,2===(o+=2)&&(a?a(w):C())};function s(e){a=e}function c(e){u=e}var l="undefined"!=typeof window?window:void 0,d=l||{},f=d.MutationObserver||d.WebKitMutationObserver,p="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),m="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function v(){return function(){return process.nextTick(w)}}function h(){return void 0!==i?function(){i(w)}:b()}function g(){var e=0,t=new f(w),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function y(){var e=new MessageChannel;return e.port1.onmessage=w,function(){return e.port2.postMessage(0)}}function b(){var e=setTimeout;return function(){return e(w,1)}}var k=new Array(1e3);function w(){for(var e=0;e<o;e+=2)(0,k[e])(k[e+1]),k[e]=void 0,k[e+1]=void 0;o=0}function S(){try{var e=Function("return this")().require("vertx");return i=e.runOnLoop||e.runOnContext,h()}catch(e){return b()}}var C=void 0;function P(e,t){var n=this,r=new this.constructor(E);void 0===r[I]&&H(r);var o=n._state;if(o){var i=arguments[o-1];u((function(){return G(o,r,i,n._result)}))}else K(n,r,e,t);return r}function D(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(E);return L(n,e),n}C=p?v():f?g():m?y():void 0===l?S():b();var I=Math.random().toString(36).substring(2);function E(){}var _=void 0,x=1,T=2;function B(){return new TypeError("You cannot resolve a promise with itself")}function N(){return new TypeError("A promises callback cannot return that same promise.")}function O(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function A(e,t,n){u((function(e){var r=!1,o=O(n,t,(function(n){r||(r=!0,t!==n?L(e,n):U(e,n))}),(function(t){r||(r=!0,F(e,t))}),"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,F(e,o))}),e)}function R(e,t){t._state===x?U(e,t._result):t._state===T?F(e,t._result):K(t,void 0,(function(t){return L(e,t)}),(function(t){return F(e,t)}))}function j(e,n,r){n.constructor===e.constructor&&r===P&&n.constructor.resolve===D?R(e,n):void 0===r?U(e,n):t(r)?A(e,n,r):U(e,n)}function L(t,n){if(t===n)F(t,B());else if(e(n)){var r=void 0;try{r=n.then}catch(e){return void F(t,e)}j(t,n,r)}else U(t,n)}function q(e){e._onerror&&e._onerror(e._result),M(e)}function U(e,t){e._state===_&&(e._result=t,e._state=x,0!==e._subscribers.length&&u(M,e))}function F(e,t){e._state===_&&(e._state=T,e._result=t,u(q,e))}function K(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+x]=n,o[i+T]=r,0===i&&e._state&&u(M,e)}function M(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)r=t[a],o=t[a+n],r?G(n,r,o,i):o(i);e._subscribers.length=0}}function G(e,n,r,o){var i=t(r),a=void 0,u=void 0,s=!0;if(i){try{a=r(o)}catch(e){s=!1,u=e}if(n===a)return void F(n,N())}else a=o;n._state!==_||(i&&s?L(n,a):!1===s?F(n,u):e===x?U(n,a):e===T&&F(n,a))}function V(e,t){try{t((function(t){L(e,t)}),(function(t){F(e,t)}))}catch(t){F(e,t)}}var J=0;function W(){return J++}function H(e){e[I]=J++,e._state=void 0,e._result=void 0,e._subscribers=[]}function Y(){return new Error("Array Methods must be provided an Array")}var z=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(E),this.promise[I]||H(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?U(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&U(this.promise,this._result))):F(this.promise,Y())}return e.prototype._enumerate=function(e){for(var t=0;this._state===_&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===D){var o=void 0,i=void 0,a=!1;try{o=e.then}catch(e){a=!0,i=e}if(o===P&&e._state!==_)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===te){var u=new n(E);a?F(u,i):j(u,e,o),this._willSettleAt(u,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===_&&(this._remaining--,e===T?F(r,n):this._result[t]=n),0===this._remaining&&U(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;K(e,void 0,(function(e){return n._settledAt(x,t,e)}),(function(e){return n._settledAt(T,t,e)}))},e}();function X(e){return new z(this,e).promise}function Q(e){var t=this;return r(e)?new t((function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))}function Z(e){var t=new this(E);return F(t,e),t}function $(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ee(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var te=function(){function e(t){this[I]=W(),this._result=this._state=void 0,this._subscribers=[],E!==t&&("function"!=typeof t&&$(),this instanceof e?V(this,t):ee())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var n=this,r=n.constructor;return t(e)?n.then((function(t){return r.resolve(e()).then((function(){return t}))}),(function(t){return r.resolve(e()).then((function(){throw t}))})):n.then(e,e)},e}();function ne(){var e=void 0;if(void 0!==n.g)e=n.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=te}return te.prototype.then=P,te.all=X,te.race=Q,te.resolve=D,te.reject=Z,te._setScheduler=s,te._setAsap=c,te._asap=u,te.polyfill=ne,te.Promise=te,te}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";const e="adtrace-sdk-demo";var t=e,r=!0;function o(){if(!r)return r;try{r=window.localStorage&&!0}catch(e){r=!1}return r}function i(e,n){if(o()){var r=localStorage.getItem("".concat(t,".").concat(e));return n?r:JSON.parse(r)}return null}function a(e,n,r){o()&&(n?localStorage.setItem("".concat(t,".").concat(e),r?n:JSON.stringify(n)):localStorage.removeItem("".concat(t,".").concat(e)))}var u,s="\n---------------------- new ----------------------\n\n",c=null;function l(){c=document.getElementById("log"),function(){if(clearInterval(u),u=setInterval((function(){return d()}),2e3),!i("log",!0))return;c.textContent=[i("log",!0),s,c.textContent].join(""),c.scrollTop=c.scrollHeight}()}function d(){var e=c.innerText.split("\n");a("log",("\n"+e.slice(Math.max(e.length-3e3,1)).join("\n")).replace(new RegExp(s,"g"),""),!0)}function f(t){var n=(new Date).toISOString();c.textContent+=["[".concat(e,"]"),n,t].join(" ")+"\n",c.scrollTop=c.scrollHeight,d()}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function k(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var w=1e3,S=36e5,C=24*S,P="general",D="gdpr",I={TRANSACTION_ERROR:"XHR transaction failed due to an error",SERVER_MALFORMED_RESPONSE:"Response from server is malformed",SERVER_INTERNAL_ERROR:"Internal error occurred on the server",SERVER_CANNOT_PROCESS:"Server was not able to process the request, probably due to error coming from the client",NO_CONNECTION:"No internet connectivity",SKIP:"Skipping slower attempt",MISSING_URL:"Url is not provided"},E="noStorage",_="indexedDB",x="localStorage",T={endpointName:"Default",app:"https://app.adtrace.io",gdpr:"https://gdpr.adtrace.io"},B={endpointName:"Indian",app:"https://app.adtrace.net.in",gdpr:"https://gdpr.adtrace.net.in"},N={endpointName:"Chinese",app:"https://app.adtrace.world",gdpr:"https://gdpr.adtrace.world"},O={endpointName:"EU",app:"https://app.eu.adtrace.io",gdpr:"https://gdpr.eu.adtrace.io"},A={endpointName:"TR",app:"https://app.tr.adtrace.io",gdpr:"https://gdpr.tr.adtrace.io"},R={endpointName:"US",app:"https://app.us.adtrace.io",gdpr:"https://gdpr.us.adtrace.io"};function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function L(e){return!Object.keys(e).length&&e.constructor===Object}function q(e){return"object"===j(e)&&null!==e&&!(e instanceof Array)}function U(e){try{return q(JSON.parse(e))}catch(e){return!1}}function F(e,t,n){function r(e){return Array.isArray(t)?t.every((function(t){return e[t]===n[t]})):e[t]===n}for(var o=0;o<e.length;o+=1)if(r(e[o]))return o;return-1}function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t){return y(y({},e),{},p({},t.key,t.value))}),{})}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.filter((function(e){return-1!==t.indexOf(e)}))}function G(e,t){return new RegExp("\\/".concat(t,"(\\/.*|\\?.*){0,1}$")).test(e)}function V(e,t){var n=h(t,2),r=n[0],o=n[1];return y(y({},e),{},p({},r,o))}function J(e){return Object.keys(e).map((function(t){return[t,e[t]]}))}function W(e){return Object.keys(e).map((function(t){return e[t]}))}function H(e){return q(e)?!L(e):!!e||0===e}function Y(){try{var e=(new Date).toString(),t=window.localStorage;t.setItem(e,e);var n=t.getItem(e)===e;return t.removeItem(e),!(!n||!t)}catch(e){return!1}}const z={namespace:"adtrace-sdk",version:"2.3.0",env:"production"};var X,Q="error",Z="warning",$="info",ee="verbose",te=(p(X={},"none",-1),p(X,Q,0),p(X,Z,1),p(X,$,2),p(X,ee,3),X),ne={log:"  ",info:" ",warn:" ",error:""},re={development:ee,production:Q,test:ee},oe=ae(),ie="";function ae(){return re[z.env]||Q}function ue(e,t){var n;if(!(te[oe]<te[t])){for(var r=(new Date).toISOString(),o=ne[e],i=["[".concat(z.namespace,"]"),r,"".concat(e.toUpperCase(),":").concat(o)],a=ie?document.querySelector(ie):null,u=arguments.length,s=new Array(u>2?u-2:0),c=2;c<u;c++)s[c-2]=arguments[c];(n=console)[e].apply(n,i.concat(s)),a&&(a.textContent+="".concat(i.join(" ")," ").concat(s.map((function(e){return q(e)?JSON.stringify(e):e})).join(" "),"\n"),a.scrollTop=a.scrollHeight)}}function se(e,t){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];ue.apply(void 0,[e,t].concat(r))}}const ce={setLogLevel:function(e,t){e&&-1===Object.keys(te).indexOf(e)?ue("error","error","You must set one of the available log levels: verbose, info, warning, error or none"):(oe=e||ae(),ie=t||ie,ue("info",e,"Log level set to ".concat(oe)))},log:se("log",ee),info:se("info",$),warn:se("warn",Z),error:se("error",Q)};var le={},de={},fe=["appToken","environment"],pe=[].concat(fe,["defaultTracker","externalDeviceId"]),me=["customUrl","dataResidency","urlStrategy","eventDeduplicationListLimit","namespace"];function ve(e){var t=fe.filter((function(t){return!e[t]}));return!!t.length&&(ce.error("You must define ".concat(function(e){if(!e.length)return"";if(1===e.length)return"".concat(e[0]);var t=e.length-1,n=e.slice(0,t).join(", ");return"".concat(n," and ").concat(e[t])}(t))),!0)}const he=y(y({},{sessionWindow:18e5,sessionTimerWindow:6e4,requestValidityWindow:28*C}),{},{set:function(e){if(!ve(e)){var t=[].concat(k(pe),me).filter((function(t){return!!e[t]})).map((function(t){return[t,e[t]]}));le=t.filter((function(e){var t=h(e,1)[0];return-1!==pe.indexOf(t)})).reduce(V,{}),de=t.filter((function(e){var t=h(e,1)[0];return-1!==me.indexOf(t)})).reduce(V,{})}},getBaseParams:function(){return y({},le)},getCustomConfig:function(){return y({},de)},isInitialised:function(){return fe.reduce((function(e,t){return e&&!!le[t]}),!0)},hasMissing:ve,destroy:function(){le={},de={}}});var ge,ye,be,ke,we;!function(e){e.Queue="queue",e.ActivityState="activityState",e.GlobalParams="globalParams",e.EventDeduplication="eventDeduplication"}(ye||(ye={})),function(e){e.Preferences="preferences"}(be||(be={})),function(e){e.Queue="q",e.ActivityState="as",e.GlobalParams="gp",e.EventDeduplication="ed"}(ke||(ke={})),function(e){e.Preferences="p"}(we||(we={}));var Se={fields:{thirdPartySharingDisabled:{key:"td",keys:{reason:{key:"r",values:p({},P,1)},pending:{key:"p",values:{false:0,true:1}}}},sdkDisabled:{key:"sd",keys:{reason:{key:"r",values:(ge={},p(ge,P,1),p(ge,D,2),ge)},pending:{key:"p",values:{false:0,true:1}}}}}};function Ce(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"values")}function Pe(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"keys")}function De(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"composite")}function Ie(e){return!!e&&"string"!=typeof e}const Ee={queue:{name:ke.Queue,scheme:{keyPath:"timestamp",autoIncrement:!1,fields:{url:{key:"u",values:{"/session":1,"/event":2,"/gdpr_forget_device":3,"/sdk_click":4,"/disable_third_party_sharing":5}},method:{key:"m",values:{GET:1,POST:2,PUT:3,DELETE:4}},timestamp:"t",createdAt:"ca",params:{key:"p",keys:{timeSpent:"ts",sessionLength:"sl",sessionCount:"sc",eventCount:"ec",lastInterval:"li",eventToken:"et",revenue:"re",currency:"cu",callbackParams:"cp",partnerParams:"pp"}}}}},activityState:{name:ke.ActivityState,scheme:{keyPath:"uuid",autoIncrement:!1,fields:{uuid:{key:"u",values:{unknown:"-"}},timeSpent:"ts",sessionLength:"sl",sessionCount:"sc",eventCount:"ec",lastActive:"la",lastInterval:"li",installed:{key:"in",values:{false:0,true:1}},sdkClickSent:{key:"scs",values:{false:0,true:1}},attribution:{key:"at",keys:{adid:"a",tracker_token:"tt",tracker_name:"tn",network:"nt",campaign:"cm",adgroup:"ag",creative:"cr",click_label:"cl",state:{key:"st",values:{installed:1,reattributed:2}}}}}}},globalParams:{name:ke.GlobalParams,scheme:{keyPath:"keyType",autoIncrement:!1,index:"type",fields:{keyType:{key:"kt",composite:["key","type"]},key:"k",value:"v",type:{key:"t",values:{callback:1,partner:2}}}}},eventDeduplication:{name:ke.EventDeduplication,scheme:{keyPath:"internalId",autoIncrement:!0,fields:{internalId:"ii",id:"i"}}},preferences:{name:we.Preferences,scheme:Se,permanent:!0}};function _e(e){try{return JSON.parse(e)}catch(t){return e}}function xe(e,t,n){var r,o=Ce(n)?{values:(r=n.values,J(r).map((function(e){var t=h(e,2),n=t[0];return[t[1],_e(n)]})).reduce(V,{}))}:{},i=Pe(n)?{keys:Te(e,n.keys)}:{},a=De(n)?{composite:n.composite.map((function(t){return Be(e,t)}))}:{};return y(y(y({key:t},o),i),a)}function Te(e,t){return J(t).map((function(t){var n=h(t,2),r=n[0],o=n[1];return Ie(o)?[o.key,xe(e,r,o)]:[o,r]})).reduce(V,{})}function Be(e,t){if(t){var n=Ee[e].scheme.fields[t];return Ie(n)?n.key:n||t}}var Ne=J(Ee).map((function(e){var t=h(e,2),n=t[0],r=t[1];return[n,{keyPath:r.scheme.keyPath,autoIncrement:r.scheme.autoIncrement,index:r.scheme.index,fields:r.scheme.fields}]})).reduce(V,{}),Oe=J(Ne).map((function(e){var t=h(e,2),n=t[0],r=t[1];return[n,{keyPath:Be(n,r.keyPath),autoIncrement:r.autoIncrement,index:Be(n,r.index),fields:Te(n,r.fields)}]})).reduce(V,{}),Ae=J(Ee).reduce((function(e,t){var n=h(t,2)[1];return e.concat(n.scheme.fields)}),[]).map((function(e){return W(e).filter(Ce).map((function(e){return J(e.values)})).reduce((function(e,t){return e.concat(t)}),[])})).reduce((function(e,t){return e.concat(t)}),[]).reduce(V,{}),Re=J(Ee).map((function(e){var t=h(e,2),n=t[0],r=t[1];return[n,{name:r.name,permanent:r.permanent}]})).reduce(V,{});const je={left:Ne,right:Oe,values:Ae,storeNames:{left:Re,right:(Le=Re,qe=J(Le).map((function(e){var t=h(e,2),n=t[0],r=t[1],o={name:n,permanent:r.permanent};return[r.name,o]})),qe.reduce(V,{}))}};var Le,qe,Ue,Fe;"undefined"==typeof Promise&&n(702).Promise;function Ke(e){return q(e)}function Me(e,t){return e&&void 0!==e[t]?e[t]:t}function Ge(e,t,n,r){if(n){var o=r||je[t][He(e,Fe.right)].fields;return J(n).map((function(n){var r=h(n,2),i=r[0],a=r[1];return function(e,t,n,r,o){if(!o)return[n,r];var i=Ie(o)?o.key:o;return Ke(r)?[i,Ge(e,t,r,Pe(o)?o.keys:null)]:[i,Me(Ce(o)?o.values:null,r)]}(e,t,i,a,o[i])})).reduce((function(e,t){var n=h(t,2),r=n[0],o=n[1];return y(y({},e),{},p({},r,o))}),{})}}function Ve(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return n.map((function(n){return Ge(e,t,n)}))}function Je(e,t,n){var r=je[t][He(e,Fe.right)],o=r.fields[r.keyPath],i=n instanceof Array?n.slice():[n],a=(De(o)?o.composite:[r.keyPath]).map((function(e,t){var n=r.fields[e];return Me(Ce(n)?n.values:null,i[t])}));return 1===a.length?a[0]:a}function We(e){return je.values[e]||e}function He(e,t){return(je.storeNames[t][e]||{}).name||e}function Ye(e,t){return{name:t.name,message:t.message.replace('"'.concat(e,'"'),He(e,Fe.right))}}function ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qe(e,t,n){return t&&Xe(e.prototype,t),n&&Xe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ze(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e+"",r=1;r<=t;r+=1)e<Math.pow(10,r)&&(n="0".concat(n));return n}function $e(e){var t=e?new Date(e):new Date,n=function(e){var t=Ze(e.getDate()),n=Ze(e.getMonth()+1);return[e.getFullYear(),n,t].join("-")}(t),r=function(e){var t=Ze(e.getHours(),1),n=Ze(e.getMinutes()),r=Ze(e.getSeconds()),o=Ze(e.getMilliseconds(),2);return[t,n,r].join(":")+"."+o}(t),o=function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+Ze(Math.floor(Math.abs(t)/60))+Ze(Math.abs(t)%60)}(t);return"".concat(n,"T").concat(r,"Z").concat(o)}function et(e,t){return isNaN(e)||isNaN(t)?0:Math.abs(t-e)}!function(e){e.LowerBound="lowerBound",e.UpperBound="upperBound"}(Ue||(Ue={})),function(e){e.right="right",e.left="left"}(Fe||(Fe={}));var tt={},nt=!1,rt=!1;function ot(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};tt=nt?y({},e):{}}function it(){nt&&(tt.lastInterval=function(){var e=tt.lastActive;if(e)return Math.round(et(e,Date.now())/w);return-1}(),tt.lastActive=Date.now())}function at(e){tt=y(y({},tt),e)}function ut(){rt=!0}function st(){var e=tt.lastActive;return Math.round(et(e,Date.now())/w)}function ct(){return(tt.timeSpent||0)+(rt?st():0)}function lt(){var e=et(tt.lastActive,Date.now())<he.sessionWindow,t=rt||!rt&&e;return(tt.sessionLength||0)+(t?st():0)}function dt(){nt&&(at({timeSpent:ct(),sessionLength:lt()}),it())}const ft={get current(){return nt?y({},tt):{}},set current(e){ot(e)},init:function(e){nt=!0,ot(e)},isStarted:function(){return nt},toForeground:ut,toBackground:function(){rt=!1},initParams:function(){dt(),ut()},getParams:function(e){if(!nt)return null;var t=tt.lastInterval>=0?tt.lastInterval:0,n={timeSpent:tt.timeSpent||0,sessionLength:tt.sessionLength||0,sessionCount:tt.sessionCount||1,lastInterval:t||0};return e&&G(e,"event")&&(n.eventCount=tt.eventCount),n},updateParams:function(e,t){if(nt){var n={};n.timeSpent=ct(),n.sessionLength=lt(),G(e,"session")&&(n.sessionCount=(tt.sessionCount||0)+1),G(e,"event")&&(n.eventCount=(tt.eventCount||0)+1),at(n),t||it()}},updateInstalled:function(){nt&&(tt.installed||at({installed:!0}))},updateSessionOffset:dt,updateSessionLength:function(){nt&&(at({sessionLength:lt()}),it())},resetSessionOffset:function(){nt&&at({timeSpent:0,sessionLength:0})},updateLastActive:it,destroy:function(){tt={},nt=!1,rt=!1},getAttribution:function(){return nt?tt.attribution?tt.attribution:(ce.log("No attribution data yet"),null):null},getWebUUID:function(){return nt?tt.uuid:null}};var pt={},mt=[];function vt(e,t){var n="id"+Math.random().toString(36).substr(2,16),r={id:n,cb:t};return pt[e]||(pt[e]=[]),pt[e].push(r),n}function ht(e,t){pt[e]&&pt[e].forEach((function(n){"function"==typeof n.cb&&mt.push(setTimeout((function(){return n.cb(e,t)})))}))}var gt=function(){function e(){ze(this,e),p(this,"items",{})}return Qe(e,[{key:"getItem",value:function(e){return Object.prototype.hasOwnProperty.call(this.items,e)?this.items[e]:null}},{key:"removeItem",value:function(e){delete this.items[e]}},{key:"setItem",value:function(e,t){this.items[e]=t}}]),e}(),yt=function(){function e(){var t=this;ze(this,e),p(this,"defaultName",z.namespace),p(this,"storageName",this.defaultName),p(this,"storeNames",je.storeNames.left),p(this,"storesMap",void 0),p(this,"storage",void 0),this.storesMap={},Y()?this.storage=window.localStorage:this.storage=new gt;var n=this.read.bind(this),r=this.write.bind(this);W(this.storeNames).forEach((function(e){var o=e.name;Object.defineProperty(t.storesMap,o,{get:function(){return n(o)},set:function(e){r(o,e)}})})),Object.freeze(this.storesMap)}return Qe(e,[{key:"read",value:function(e){var t=this.storage.getItem("".concat(this.storageName,".").concat(e)),n=t?JSON.parse(t):null;return e===we.Preferences&&n?Ge(we.Preferences,Fe.right,n):n}},{key:"write",value:function(e,t){t?this.storage.setItem("".concat(this.storageName,".").concat(e),JSON.stringify(t instanceof Array?t:Ge(we.Preferences,Fe.left,t))):this.storage.removeItem("".concat(this.storageName,".").concat(e))}},{key:"clear",value:function(){this.deleteData()}},{key:"deleteData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];W(this.storeNames).forEach((function(n){!t&&n.permanent||e.storage.removeItem("".concat(e.storageName,".").concat(n.name))}))}},{key:"setCustomName",value:function(e){var t=this;if(e&&e.length){var n="".concat(z.namespace,"-").concat(e);W(this.storeNames).forEach((function(e){var r=e.name,o=t.storage.getItem("".concat(t.storageName,".").concat(r));o&&t.storage.setItem("".concat(n,".").concat(r),o)})),this.deleteData(!0),this.storageName=n}}},{key:"stores",get:function(){return this.storesMap}}]),e}();const bt=new yt;var kt=Ee.preferences.name,wt=St();function St(){return wt||Ct(),wt?y({},wt):null}function Ct(){wt=bt.stores[kt]}function Pt(){var e=St();return e?e.sdkDisabled:null}function Dt(e){var t=e?y({},e):null;bt.stores[kt]=y(y({},St()),{},{sdkDisabled:t}),Ct()}function It(){var e=St();return e?e.thirdPartySharingDisabled:null}function Et(){var e=bt.stores[kt]||{},t=(wt||{}).sdkDisabled||null;e.sdkDisabled&&!t&&ht("sdk:shutdown"),Ct()}function _t(){bt.stores[kt]||(bt.stores[kt]=y({},wt))}var xt,Tt,Bt="undefined"==typeof Promise?n(702).Promise:Promise;!function(e){e.add="add",e.put="put",e.get="get",e.list="list",e.clear="clear",e.delete="delete"}(xt||(xt={})),function(e){e.readonly="readonly",e.readwrite="readwrite"}(Tt||(Tt={}));var Nt=function(){function e(){ze(this,e),p(this,"dbDefaultName",z.namespace),p(this,"dbName",this.dbDefaultName),p(this,"dbVersion",1),p(this,"idbFactory",void 0),p(this,"indexedDbConnection",null),p(this,"notSupportedError",{name:"IDBNotSupported",message:"IndexedDB is not supported"}),p(this,"databaseOpenError",{name:"CannotOpenDatabaseError",message:"Cannot open a database"}),p(this,"noConnectionError",{name:"NoDatabaseConnection",message:"Cannot open a transaction"});var t=e.getIndexedDB();if(!t)throw this.notSupportedError;this.idbFactory=t}return Qe(e,[{key:"setCustomName",value:function(e){return e&&e.length>0?(this.dbName="".concat(z.namespace,"-").concat(e),this.migrateDb(this.dbDefaultName,this.dbName)):Bt.resolve()}},{key:"openDatabase",value:function(t,n,r){var o=this;return e.isSupported().then((function(e){return e?new Bt((function(e,i){var a=o.idbFactory.open(t,r);n&&(a.onupgradeneeded=function(e){return n(e,i)}),a.onsuccess=function(t){var n=t.target.result;n?e(n):i(o.databaseOpenError)},a.onerror=i})):Bt.reject(o.notSupportedError)}))}},{key:"databaseExists",value:function(e){var t=this;return new Bt((function(n){var r=!0;t.openDatabase(e,(function(){r=!1})).then((function(n){if(n.close(),!r)return t.deleteDatabaseByName(e)})).then((function(){return n(r)}))}))}},{key:"cloneData",value:function(e,t){var n=this;return W(je.storeNames.left).map((function(e){return e.name})).filter((function(e){return"p"!==e})).map((function(r){return function(){return o=r,i=n.indexedDbConnection,n.indexedDbConnection=e,n.getAll(o).then((function(e){if(n.indexedDbConnection=t,!(e.length<1))return n.addBulk(o,e,!0)})).then((function(){n.indexedDbConnection=i}));var o,i}})).reduce((function(e,t){return e.then(t)}),Bt.resolve())}},{key:"migrateDb",value:function(e,t){var n=this;return this.databaseExists(e).then((function(r){return r?Bt.all([n.openDatabase(e,n.handleUpgradeNeeded,n.dbVersion),n.openDatabase(t,n.handleUpgradeNeeded,n.dbVersion)]).then((function(t){var r=h(t,2),o=r[0],i=r[1];return n.cloneData(o,i).then((function(){return n.indexedDbConnection=i,o.close(),n.deleteDatabaseByName(e)}))})).then((function(){return ce.info("Database migration finished")})):n.openDatabase(t,n.handleUpgradeNeeded,n.dbVersion).then((function(e){n.indexedDbConnection=e}))}))}},{key:"handleUpgradeNeeded",value:function(e,t){var n=e.target.result;e.target.transaction.onerror=t,e.target.transaction.onabort=t;var r=je.storeNames.left,o=ft.current||{},i=o&&!L(o);J(r).filter((function(e){return!h(e,2)[1].permanent})).forEach((function(e){var t=h(e,2),r=t[0],a=t[1].name,u=je.right[r],s=n.createObjectStore(a,{keyPath:u.keyPath,autoIncrement:u.autoIncrement||!1});if(u.index&&s.createIndex("".concat(u.index,"Index"),u.index),a===ke.ActivityState&&i)return s.add(Ge(r,Fe.left,o)),void ce.info("Activity state has been recovered");var c=bt.stores[a];c&&(c.forEach((function(e){return s.add(e)})),ce.info("Migration from localStorage done for ".concat(r," store")))})),_t(),bt.clear()}},{key:"open",value:function(){var e=this;return this.indexedDbConnection?Bt.resolve({success:!0}):this.openDatabase(this.dbName,this.handleUpgradeNeeded,this.dbVersion).then((function(t){return e.indexedDbConnection=t,e.indexedDbConnection.onclose=function(){return e.destroy},{success:!0}}))}},{key:"getTransactionStore",value:function(e,t,n){var r,o=e.storeName,i=e.mode,a=n.transaction([o],i),u=a.objectStore(o),s=je.right[He(o,Fe.right)];return s.index&&(r=u.index("".concat(s.index,"Index"))),a.onerror=t,a.onabort=t,{transaction:a,store:u,index:r,options:s}}},{key:"overrideError",value:function(e,t){var n=t.target.error;return e({name:n.name,message:n.message})}},{key:"getCompositeKeys",value:function(e){var t=e.fields[e.keyPath];return De(t)?t.composite:null}},{key:"targetIsObject",value:function(e){return q(e)}},{key:"prepareTarget",value:function(e,t,n){if(n===xt.clear||!t)return null;var r=this.getCompositeKeys(e);return-1!==[xt.add,xt.put].indexOf(n)?this.targetIsObject(t)?r?y(p({},e.keyPath,r.map((function(e){return t[e]})).join("")),t):t:null:t instanceof Array?t.join(""):t}},{key:"prepareResult",value:function(e,t){var n=this.getCompositeKeys(e);return n&&this.targetIsObject(t)?n.map((function(e){return t[e]})):null}},{key:"initRequest",value:function(e){var t=this,n=e.storeName,r=e.target,o=void 0===r?null:r,i=e.action,a=e.mode,u=void 0===a?Tt.readonly:a;return this.open().then((function(){return new Bt((function(e,r){if(t.indexedDbConnection){var a=t.getTransactionStore({storeName:n,mode:u},r,t.indexedDbConnection),s=a.store,c=a.options,l=s[i](t.prepareTarget(c,o,i)),d=t.prepareResult(c,o);l.onsuccess=function(){i!==xt.get||l.result?e(d||l.result||o):r({name:"NotRecordFoundError",message:'Requested record not found in "'.concat(n,'" store')})},l.onerror=function(e){return t.overrideError(r,e)}}else r(t.noConnectionError)}))}))}},{key:"initBulkRequest",value:function(e){var t=this,n=e.storeName,r=e.target,o=e.action,i=e.mode,a=void 0===i?Tt.readwrite:i;return!r||r&&!r.length?Bt.reject({name:"NoTargetDefined",message:"No array provided to perform ".concat(o,' bulk operation into "').concat(n,'" store')}):this.open().then((function(){return new Bt((function(e,i){if(t.indexedDbConnection){var u=t.getTransactionStore({storeName:n,mode:a},i,t.indexedDbConnection),s=u.transaction,c=u.store,l=u.options,d=new Array,f=r[0];s.oncomplete=function(){return e(d)};!function e(n){n.onerror=function(e){return t.overrideError(i,e)},n.onsuccess=function(){d.push(t.prepareResult(l,f)||n.result),f=r[d.length],d.length<r.length&&e(c[o](t.prepareTarget(l,f,o)))}}(c[o](t.prepareTarget(l,f,o)))}else i(t.noConnectionError)}))}))}},{key:"openCursor",value:function(e){var t=this,n=e.storeName,r=e.action,o=e.range,i=void 0===o?null:o,a=e.firstOnly,u=void 0!==a&&a,s=e.mode,c=void 0===s?Tt.readonly:s;return this.open().then((function(){return new Bt((function(e,o){if(t.indexedDbConnection){var a=t.getTransactionStore({storeName:n,mode:c},o,t.indexedDbConnection),s=a.transaction,l=a.store,d=a.index,f=a.options,p=(d||l).openCursor(i),m=new Array;s.oncomplete=function(){return e(m)},p.onsuccess=function(e){var n=e.target.result;n&&(r===xt.delete?(n.delete(),m.push(t.prepareResult(f,n.value)||n.value[f.keyPath])):m.push(n.value),u||n.continue())},p.onerror=function(e){return t.overrideError(o,e)}}else o(t.noConnectionError)}))}))}},{key:"deleteDatabaseByName",value:function(e){var t=this;return new Bt((function(n,r){var o=t.idbFactory.deleteDatabase(e);o.onerror=function(e){return t.overrideError(r,e)},o.onsuccess=function(){return n()},o.onblocked=function(e){return r(e.target)}}))}},{key:"getAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.openCursor({storeName:e,action:xt.list,firstOnly:t})}},{key:"getFirst",value:function(e){return this.getAll(e,!0).then((function(e){return e.length?e[0]:void 0}))}},{key:"getItem",value:function(e,t){return this.initRequest({storeName:e,target:t,action:xt.get})}},{key:"filterBy",value:function(e,t){var n=IDBKeyRange.only(t);return this.openCursor({storeName:e,action:xt.list,range:n})}},{key:"addItem",value:function(e,t){return this.initRequest({storeName:e,target:t,action:xt.add,mode:Tt.readwrite})}},{key:"addBulk",value:function(e,t,n){return this.initBulkRequest({storeName:e,target:t,action:n?xt.put:xt.add,mode:Tt.readwrite})}},{key:"updateItem",value:function(e,t){return this.initRequest({storeName:e,target:t,action:xt.put,mode:Tt.readwrite})}},{key:"deleteItem",value:function(e,t){return this.initRequest({storeName:e,target:t,action:xt.delete,mode:Tt.readwrite})}},{key:"deleteBulk",value:function(e,t,n){var r=n?IDBKeyRange[n](t):IDBKeyRange.only(t);return this.openCursor({storeName:e,action:xt.delete,range:r,mode:Tt.readwrite})}},{key:"trimItems",value:function(e,t){var n=this,r=je.right[He(e,Fe.right)];return this.getAll(e).then((function(e){return e.length?e[t-1]:null})).then((function(t){return t?n.deleteBulk(e,t[r.keyPath],Ue.UpperBound):[]}))}},{key:"count",value:function(e){var t=this;return this.open().then((function(){return new Bt((function(n,r){if(t.indexedDbConnection){var o=t.getTransactionStore({storeName:e,mode:Tt.readonly},r,t.indexedDbConnection).store.count();o.onsuccess=function(){return n(o.result)},o.onerror=function(e){return t.overrideError(r,e)}}else r(t.noConnectionError)}))}))}},{key:"clear",value:function(e){return this.initRequest({storeName:e,action:xt.clear,mode:Tt.readwrite})}},{key:"destroy",value:function(){this.indexedDbConnection&&this.indexedDbConnection.close(),this.indexedDbConnection=null}},{key:"deleteDatabase",value:function(){return this.destroy(),this.deleteDatabaseByName(this.dbName)}}],[{key:"tryOpen",value:function(t){return new Bt((function(n){try{var r=t.open(e.dbValidationName);r.onsuccess=function(){r.result.close(),t.deleteDatabase(e.dbValidationName),n(!0)},r.onerror=function(){return n(!1)}}catch(e){n(!1)}}))}},{key:"isSupported",value:function(){if(e.isSupportedPromise)return e.isSupportedPromise;var t="IndexedDB is not supported in this browser";return e.isSupportedPromise=new Bt((function(n){var r=e.getIndexedDB(),o=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);!r||o?(ce.warn(t),n(!1)):n(e.tryOpen(r).then((function(e){return e||ce.warn(t),e})))})),e.isSupportedPromise}},{key:"getIndexedDB",value:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB}}]),e}();p(Nt,"dbValidationName","validate-db-openable"),p(Nt,"isSupportedPromise",null);var Ot="undefined"==typeof Promise?n(702).Promise:Promise,At=function(){function e(){ze(this,e)}return Qe(e,[{key:"open",value:function(){return e.isSupported().then((function(e){if(!e)return{status:"error",error:{name:"LSNotSupported",message:"LocalStorage is not supported"}};var t=je.storeNames.left,n=ft.current||{},r=n&&!L(n);return J(t).filter((function(e){return!h(e,2)[1].permanent})).forEach((function(e){var t=h(e,2),o=t[0],i=t[1].name;i!==ke.ActivityState||bt.stores[i]?bt.stores[i]||(bt.stores[i]=[]):bt.stores[i]=r?[Ge(o,Fe.left,n)]:[]})),_t(),{status:"success"}}))}},{key:"getCompositeKeys",value:function(e){var t=e.fields[e.keyPath];return De(t)?t.composite:null}},{key:"getKeys",value:function(e){var t=He(e,Fe.right),n=je.right[t];return this.getCompositeKeys(n)||[n.keyPath]}},{key:"nextIndex",value:function(e){return"number"==typeof e?e+1:void 0}},{key:"initRequest",value:function(e,t){var n=this,r=e.storeName,o=e.id,i=e.item,a=je.right[He(r,Fe.right)];return this.open().then((function(e){return"error"===e.status?Ot.reject(e.error):new Ot((function(e,u){var s,c=bt.stores[r],l=n.getKeys(r),d=(c[c.length-1]||{})[a.keyPath]||0;if(o){var f=Array.isArray(o)?o.slice():[o];s=l.map((function(e,t){return[e,f[t]]})).reduce(V,{})}else s=y({},i);var p=s?F(c,l,s):0;return t(e,u,{keys:l,items:c,index:p,options:a,lastId:d})}))}))}},{key:"sort",value:function(e,t,n){var r=k(e),o=t.slice().reverse();return r.sort((function(e,t){return o.reduce((function(r,o){return r||function(e,t,r){var o=n?n===e[r]:e[r]<t[r],i=n?n>e[r]:e[r]>t[r];return o?-1:i?1:0}(e,t,o)}),0)}))}},{key:"prepareTarget",value:function(e,t,n){var r=this.getCompositeKeys(e);return r?y(p({},e.keyPath,r.map((function(e){return t[e]})).join("")),t):e.autoIncrement&&n?y(p({},e.keyPath,n),t):y({},t)}},{key:"prepareResult",value:function(e,t){var n=this.getCompositeKeys(e);return n?n.map((function(e){return t[e]})).filter((function(e){return!Ke(e)})):t[e.keyPath]}},{key:"getAll",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.open().then((function(r){return"error"===r.status?Ot.reject(r.error):new Ot((function(r,o){var i=bt.stores[e];i instanceof Array?r(n?[i[0]]:t.sort(i,t.getKeys(e))):o({name:"NotFoundError",message:"No objectStore named ".concat(e," in this database")})}))}))}},{key:"getFirst",value:function(e){return this.getAll(e,!0).then((function(e){return e.length?e[0]:void 0}))}},{key:"getItem",value:function(e,t){var n=this;return this.initRequest({storeName:e,id:t},(function(t,r,o){var i=o.items,a=o.index,u=o.options;-1===a?r({name:"NotRecordFoundError",message:'Requested record not found in "'.concat(e,'" store')}):t(n.prepareTarget(u,i[a]))}))}},{key:"filterBy",value:function(e,t){return this.getAll(e).then((function(n){return n.filter((function(n){var r=je.right[He(e,Fe.right)];return(r.index&&n[r.index])===t}))}))}},{key:"addItem",value:function(e,t){var n=this;return this.initRequest({storeName:e,item:t},(function(r,o,i){var a=i.items,u=i.index,s=i.options,c=i.lastId;-1!==u?o({name:"ConstraintError",message:'Constraint was not satisfied, trying to add existing item into "'.concat(e,'" store')}):(a.push(n.prepareTarget(s,t,n.nextIndex(c))),bt.stores[e]=a,r(n.prepareResult(s,t)))}))}},{key:"addBulk",value:function(e,t,n){var r=this;return this.initRequest({storeName:e},(function(o,i,a){var u=a.keys,s=a.items,c=a.options,l=a.lastId;if(!t||t&&!t.length)i({name:"NoTargetDefined",message:'No array provided to perform add bulk operation into "'.concat(e,'" store')});else{var d=l,f=t.map((function(e){return r.prepareTarget(c,e,d=r.nextIndex(d))})),p=f.filter((function(e){return-1!==F(s,u,e)})).map((function(e){return e[c.keyPath]})),m=n?s.filter((function(e){return-1===p.indexOf(e[c.keyPath])})):k(s);if(p.length&&!n)i({name:"ConstraintError",message:'Constraint was not satisfied, trying to add existing items into "'.concat(e,'" store')});else bt.stores[e]=r.sort([].concat(k(m),k(f)),u),o(t.map((function(e){return r.prepareResult(c,e)})))}}))}},{key:"updateItem",value:function(e,t){var n=this;return this.initRequest({storeName:e,item:t},(function(r,o,i){var a=i.items,u=i.index,s=i.options,c=i.lastId,l=-1===u?n.nextIndex(c):void 0,d=n.prepareTarget(s,t,l);-1===u?a.push(d):a.splice(u,1,d),bt.stores[e]=a,r(n.prepareResult(s,t))}))}},{key:"deleteItem",value:function(e,t){return this.initRequest({storeName:e,id:t},(function(n,r,o){var i=o.items,a=o.index;-1!==a&&(i.splice(a,1),bt.stores[e]=i),n(t)}))}},{key:"findMax",value:function(e,t,n){if(!e.length)return-1;for(var r={index:-1,value:"string"==typeof n?"":0},o=0;o<e.length;o+=1){if(!(e[o][t]<=n))return r.index;e[o][t]>=r.value&&(r={value:e[o][t],index:o})}return r.index}},{key:"deleteBulk",value:function(e,t,n){var r=this;return this.getAll(e).then((function(o){var i=r.getKeys(e),a=je.right[He(e,Fe.right)].index||i[0],u=n?null:t,s=r.sort(o,i,u),c=r.findMax(s,a,t);if(-1===c)return[];var l=n===Ue.LowerBound?c:0,d=n&&n!==Ue.UpperBound?s.length:c+1,f=s.splice(l,d).map((function(e){return 1===i.length?e[a]:i.map((function(t){return e[t]}))}));return bt.stores[e]=s,f}))}},{key:"trimItems",value:function(e,t){var n=this,r=He(e,Fe.right),o=je.right[r];return this.getAll(e).then((function(e){return e.length?e[t-1]:null})).then((function(t){return t?n.deleteBulk(e,t[o.keyPath],Ue.UpperBound):[]}))}},{key:"count",value:function(e){return this.open().then((function(t){if("error"===t.status)return Ot.reject(t.error);var n=bt.stores[e];return Ot.resolve(n instanceof Array?n.length:1)}))}},{key:"clear",value:function(e){return this.open().then((function(t){return"error"===t.status?Ot.reject(t.error):new Ot((function(t){bt.stores[e]=[],t()}))}))}},{key:"destroy",value:function(){}},{key:"deleteDatabase",value:function(){}}],[{key:"isSupported",value:function(){return e.isSupportedPromise||(e.isSupportedPromise=new Ot((function(e){var t=Y();t||ce.warn("LocalStorage is not supported in this browser"),e(t)}))),e.isSupportedPromise}}]),e}();p(At,"isSupportedPromise",null);var Rt,jt="undefined"==typeof Promise?n(702).Promise:Promise;!function(e){e[e.noStorage=E]="noStorage",e[e.indexedDB=_]="indexedDB",e[e.localStorage=x]="localStorage"}(Rt||(Rt={}));var Lt,qt={getAll:function(e,t,n){return e.getAll(t,n).then((function(e){return Ve(t,Fe.right,e)}))},getFirst:function(e,t){return e.getFirst(t).then((function(e){return Ge(t,Fe.right,e)}))},getItem:function(e,t,n){return e.getItem(t,Je(t,Fe.left,n)).then((function(e){return Ge(t,Fe.right,e)})).catch((function(e){return jt.reject(Ye(t,e))}))},filterBy:function(e,t,n){return e.filterBy(t,We(n)).then((function(e){return Ve(t,Fe.right,e)}))},addItem:function(e,t,n){var r=Ge(t,Fe.left,n);return e.addItem(t,r).then((function(e){return Je(t,Fe.right,e)})).catch((function(e){return jt.reject(Ye(t,e))}))},addBulk:function(e,t,n,r){var o=Ve(t,Fe.left,n);return e.addBulk(t,o,r).then((function(e){return e.map((function(e){return Je(t,Fe.right,e)}))})).catch((function(e){return jt.reject(Ye(t,e))}))},updateItem:function(e,t,n){var r=Ge(t,Fe.left,n);return e.updateItem(t,r).then((function(e){return Je(t,Fe.right,e)}))},deleteItem:function(e,t,n){return e.deleteItem(t,Je(t,Fe.left,n)).then((function(e){return Je(t,Fe.right,e)}))},deleteBulk:function(e,t,n,r){return e.deleteBulk(t,We(n),r).then((function(e){return e.map((function(e){return Je(t,Fe.right,e)}))}))},trimItems:function(e,t,n){return e.trimItems(t,n)},count:function(e,t){return e.count(t)},clear:function(e,t){return e.clear(t)},destroy:function(e){return e.destroy()},deleteDatabase:function(e){return e.deleteDatabase()}};var Ut=null;function Ft(e){var t=null;return null!==Ut?Ut:Ut=jt.all([Nt.isSupported(),At.isSupported()]).then((function(n){var r=h(n,2),o=r[0],i=r[1];if(bt.setCustomName(e),o){Lt=Rt.indexedDB;var a=new Nt;return a.setCustomName(e).then((function(){return t=a}))}return i?(Lt=Rt.localStorage,t=new At,jt.resolve(t)):(ce.error("There is no storage available, app will run with minimum set of features"),Lt=Rt.noStorage,t=null,jt.resolve(t))})).then((function(){return{type:Lt,storage:t}}))}const Kt=y({init:Ft,getType:function(){return Lt}},(Mt=J(qt).map((function(e){var t=h(e,2),n=t[0],r=t[1];return[n,function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Ft().then((function(t){var o=t.storage;if(o)return r.call.apply(r,[null,o,He(e,Fe.left)].concat(n))}))}]})),Mt.reduce(V,{})));var Mt;"undefined"==typeof Promise&&n(702).Promise;function Gt(){return Kt.getAll("queue").then((function(e){return{queueSize:e.length}})).then((function(e){return y(y(y(y(y(y(y(y({},{createdAt:$e()}),{sentAt:$e()}),{webUuid:ft.current.uuid}),(n=navigator,r=void 0!==n.doNotTrack,o=void 0!==window.doNotTrack,i=void 0!==n.msDoNotTrack,a=r?n.doNotTrack:o?window.doNotTrack:i?n.msDoNotTrack:null,0===parseInt(a,10)||"no"===a?{trackingEnabled:!0}:1===parseInt(a,10)||"yes"===a?{trackingEnabled:!1}:null)),{platform:"web"}),function(){var e=navigator,t=h((e.language||e.userLanguage||"en").split("-"),2),n=t[0],r=t[1];return{language:n,country:r?""+r.toLowerCase():void 0}}()),(t=navigator.userAgent||navigator.vendor,{machineType:"Win32"!==navigator.platform||-1===t.indexOf("WOW64")&&-1===t.indexOf("Win64")?navigator.platform:"Win64"})),e);var t,n,r,o,i,a}))}var Vt="undefined"==typeof Promise?n(702).Promise:Promise;function Jt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{status:"error",action:n?"CONTINUE":"RETRY",response:U(e.responseText)?JSON.parse(e.responseText):e.responseText,message:I[t],code:t}}function Wt(e,t){var n=e.slice(0,e.length-t.length-1).split("").reduce((function(e){return e.concat(" ")}),"");return"".concat(t).concat(n,":")}function Ht(e,t){var n="REQUEST PARAMETERS:",r=function(e){return e.replace(/([A-Z])/g,(function(e){return"_".concat(e.toLowerCase())}))},o=J(y(y(y({},he.getBaseParams()),t),e)).map((function(e){var t=h(e,2),n=t[0],o=t[1];return[r(n),o]}));return ce.log(n),o.filter((function(e){return H(h(e,2)[1])})).map((function(e){var t=h(e,2),r=t[0],o=t[1];return ce.log(Wt(n,r),o),function(e){var t=h(e,2),n=t[0],r=t[1],o=encodeURIComponent(n),i=r;return"string"==typeof r&&(i=encodeURIComponent(r)),q(r)&&(i=encodeURIComponent(JSON.stringify(r)||"")),[o,i].join("=")}([r,o])})).join("&")}function Yt(e,t,n){var r=n.xhr,o=n.url;if(4===r.readyState){var i=r.status>=200&&r.status<300,a=U(r.responseText);if(0!==r.status)return a?t(i?function(e,t){var n=JSON.parse(e.responseText),r={status:"success",adid:n.adid,timestamp:n.timestamp,ask_in:n.ask_in,retry_in:n.retry_in,continue_in:n.continue_in,tracking_state:n.tracking_state,attribution:void 0,message:void 0};return G(t,"attribution")&&(r.attribution=n.attribution,r.message=n.message),J(r).filter((function(e){return!!h(e,2)[1]})).reduce(V,{})}(r,o):Jt(r,"SERVER_CANNOT_PROCESS",!0)):e(Jt(r,i?"SERVER_MALFORMED_RESPONSE":"SERVER_INTERNAL_ERROR"));e(Jt(r,"NO_CONNECTION"))}}function zt(e,t){var n=e.endpoint,r=e.url,o=e.method,i=void 0===o?"GET":o,a=e.params,u=function(e,t){var n=e.endpoint,r=e.url,o=e.method,i=Ht(e.params,t);return{fullUrl:n+r+("GET"===o?"?".concat(i):""),encodedParams:i}}({endpoint:n,url:r,method:i,params:void 0===a?{}:a},t),s=u.fullUrl,c=u.encodedParams;return new Vt((function(e,t){var n=new XMLHttpRequest;n.open(i,s,!0),function(e,t){var n="REQUEST HEADERS:",r=[["Client-SDK","js".concat(z.version)],["Content-Type","POST"===t?"application/x-www-form-urlencoded":"application/json"]];ce.log(n),r.forEach((function(t){var r=h(t,2),o=r[0],i=r[1];e.setRequestHeader(o,i),ce.log(Wt(n,o),i)}))}(n,i),n.onreadystatechange=function(){return Yt(t,e,{xhr:n,url:r})},n.onerror=function(){return t(Jt(n,"TRANSACTION_ERROR"))},n.send("GET"===i?void 0:c)}))}function Xt(e,t){return"success"===e.status?function(e,t){var n=G(t,"gdpr_forget_device"),r=G(t,"attribution"),o=G(t,"session"),i=G(t,"disable_third_party_sharing"),a="opted_out"===e.tracking_state;if(!n&&a)return ht("sdk:gdpr-forget-me"),e;r||n||a||!e.ask_in||ht("attribution:check",e);o&&ht("session:finished",e);if(i)return ht("sdk:third-party-sharing-opt-out"),e;return e}(e,t):e}function Qt(e){return Gt().then((function(t){return zt(e,t)})).then((function(t){return Xt(t,e.url)}))}var Zt={long:{delay:12e4,maxDelay:C,minRange:.5,maxRange:1},short:{delay:200,maxDelay:S,minRange:.5,maxRange:1},test:{delay:100,maxDelay:300}};function $t(e,t){var n,r,o=Zt[t=t||"long"],i=o.delay*Math.pow(2,e-1);return i=Math.min(i,o.maxDelay),o.minRange&&o.maxRange&&(i*=(n=o.minRange,r=o.maxRange,Math.random()*(r-n)+n)),Math.round(i)}var en,tn,nn,rn=navigator.onLine;function on(){rn=!0}function an(){rn=!1}function un(e,t,n){e.addEventListener&&e.addEventListener(t,n,!1)}function sn(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}function cn(){return rn}function ln(e,t){ce.warn("Both ".concat(e," and ").concat(t," are set in config, ").concat(t," will be ignored"))}!function(e){e.Default="default",e.India="india",e.China="china"}(tn||(tn={})),function(e){e.EU="EU",e.TR="TR",e.US="US"}(nn||(nn={}));var dn=(p(en={},tn.Default,T),p(en,tn.India,B),p(en,tn.China,N),p(en,nn.EU,O),p(en,nn.TR,A),p(en,nn.US,R),en);function fn(e){var t,n,r,o,i=(t=he.getCustomConfig(),n=t.customUrl,r=t.urlStrategy,o=t.dataResidency,n?((o||r)&&ln("customUrl",o?"dataResidency":"urlStrategy"),{app:n,gdpr:n}):(o&&r&&ln("dataResidency","urlStrategy"),o?[o]:r===tn.India?[tn.India,tn.Default]:r===tn.China?[tn.China,tn.Default]:[tn.Default,tn.India,tn.China]));return Array.isArray(i)?i.map((function(t){return e[t]||null})).filter((function(e){return!!e})):[i]}function pn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dn,t=fn(e),n=0;return{next:function(){return n<t.length?{value:t[n++],done:!1}:{value:void 0,done:!0}},reset:function(){n=0}}}var mn="undefined"==typeof Promise?n(702).Promise:Promise,vn=150,hn=2147483647,gn=6e4;const yn=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.url,o=n.method,i=void 0===o?"GET":o,a=n.params,u=void 0===a?{}:a,s=n.continueCb,c=n.strategy,l=n.wait,d={url:r,method:i,params:u,continueCb:s},f=r,p=i,m=y({},u),v=s,g=c,b=function(){e.reset(),t=e.next()},k=function(e,t){return e["/gdpr_forget_device"===t?"gdpr":"app"]},w=null,S={request:0,connection:0},C=D(l),P=null;function D(e){return(e=e||vn)>hn?hn:e}function E(e){var t=e.url,n=e.method,r=e.params,o=e.continueCb;t&&(f=t),n&&(p=n),L(r)||(m=y({},r)),m=y({createdAt:$e()},m),"function"==typeof o&&(v=o)}function _(e){if(!P)return!1;if(w){var t=C-(Date.now()-P);if(e&&t<e)return!0;K()}return!1}function x(n){var r=n.wait,o=n.retrying;return e||(e=pn(),t=e.next()),C=r?D(r):C,_(r)?mn.resolve({status:"error",action:"CONTINUE",response:"",message:I.SKIP,code:"SKIP"}):f?(ce.log("".concat(o?"Re-trying":"Trying"," request ").concat(f," in ").concat(C,"ms")),P=Date.now(),T({endpoint:k(t.value,f),url:f,method:p,params:y({attempts:1},m)})):(ce.error("You must define url for the request to be sent"),mn.reject({status:"error",action:"CONTINUE",response:"",message:I.MISSING_URL,code:"MISSING_URL"}))}function T(e){return F(),cn()?B(e):(S.connection+=1,ce.log("No internet connectivity, trying request ".concat(e.url," in ").concat(gn,"ms")),new mn((function(t){w=setTimeout((function(){t(T(e))}),gn)})))}function B(e){return new mn((function(t,n){w=setTimeout((function(){P=null;var r=J(e.params).filter((function(e){return H(h(e,2)[1])})).reduce(V,{});return Qt({endpoint:e.endpoint,url:e.url,method:e.method,params:y(y({},r),{},{attempts:(S.request?S.request+1:1)+S.connection})}).then((function(e){return R(e,t)})).catch((function(e){return j(e,t,n)}))}),C)}))}function N(){f=d.url,p=d.method,m=y({},d.params),v=d.continueCb}function O(e){ce.log("Request ".concat(f||"unknown"," ").concat(e?"failed":"has been finished")),S.request=0,S.connection=0,C=vn,N(),K()}function A(e){return S.request+=1,K(),x({wait:e||$t(S.request,g),retrying:!0})}function R(e,t){e&&e.retry_in?t(A(e.retry_in)):(b(),"function"==typeof v?v(e,O,A):O(),t(e))}function j(n,r,o){if(n&&"RETRY"===n.action)if("NO_CONNECTION"===n.code){var i=e.next();i.done?(b(),r(A(gn))):(t=i,r(A(vn)))}else r(A());else O(!0),o(n||{})}function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n=e.method,r=e.params,o=void 0===r?{}:r,i=e.continueCb,a=e.wait;return E({url:t,method:n,params:o,continueCb:i}),x({wait:a})}function U(){return!!w}function F(){w&&clearTimeout(w),w=null}function K(){var e=!!P;F(),P=null,e&&(C=vn,S.request=0,S.connection=0,ce.log("Previous ".concat(f||"unknown"," request attempt canceled")),N())}return{send:q,isRunning:U,clear:K}};var bn=function(e){return e===D?"GDPR disable":"disable"},kn=function(e){return{start:{inProgress:"Adtrace SDK ".concat(bn(e)," process has already started"),done:"Adtrace SDK ".concat(bn(e)," process is now started")},finish:{inProgress:"Adtrace SDK ".concat(bn(e)," process has already finished"),done:"Adtrace SDK ".concat(bn(e)," process is now finished")}}};function wn(e,t){var n=e.reason,r=e.pending,o=Pt()||{},i="start"===t&&o.pending?"start":"finish",a="start"===t&&o.reason,u="finish"===t&&o.reason&&!o.pending;return a||u?(ce.log(kn(o.reason)[i].inProgress),!1):(ce.log(kn(n)[i].done),Dt({reason:n||P,pending:r}),!0)}function Sn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return wn({reason:e,pending:t||!1},"start")}function Cn(){var e=Pt()||{};return e.reason===P||e.reason===D&&!e.pending?"off":e.reason===D&&e.pending?"paused":"on"}var Pn="undefined"==typeof Promise?n(702).Promise:Promise,Dn="activityState",In=!1;function En(e){return e?"unknown"===e.uuid?(Sn({reason:D}),ft.destroy(),{exists:!0,stored:null}):(ft.init(e),{exists:!0,stored:e}):{exists:!1}}function _n(){return"off"!==Cn()&&ft.isStarted()}function xn(){if(!_n())return Pn.resolve(null);var e=y(y({},ft.current),{},{lastActive:Date.now()});return Kt.updateItem(Dn,e).then((function(){return ft.current=e}))}var Tn="undefined"==typeof Promise?n(702).Promise:Promise,Bn=yn({strategy:"long",continueCb:function(e,t){var n=e&&e.continue_in||null;return An.pause=n?{timestamp:Date.now(),wait:n}:null,Kt.getFirst(On).then((function(e){return e?Kt.deleteItem(On,e.timestamp):null})).then((function(){return t(),An.running=!1,Fn({wait:n})}))}}),Nn=!1,On="queue",An={running:!1,timestamp:null,pause:null};function Rn(){var e=Date.now();return An.timestamp&&e<=An.timestamp&&(e=An.timestamp+1),An.timestamp=e,e}function jn(e){return G(e,"session")&&ft.resetSessionOffset(),ft.updateLastActive(),xn()}function Ln(e){var t=e.url,n=e.method,r=e.params,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.auto,a=o.timestamp;ft.updateParams(t,i);var u=J(r||{}).filter((function(e){return H(h(e,2)[1])})).reduce(V,{}),s={timestamp:Rn(),url:t,method:n,params:y(y({},ft.getParams(t)),u)};return a&&(s.createdAt=a),Kt.addItem(On,s).then((function(){return jn(t)})).then((function(){return An.running?{}:Fn()}))}function qn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.timestamp,n=e.createdAt,r=e.url,o=e.method,i=e.params,a=arguments.length>1?arguments[1]:void 0,u=ft.current||{},s="/session"===r&&!u.installed,c=!r&&!o&&!i;return Nn&&!s||c?(An.running=!1,Tn.resolve({})):Bn.send({url:r,method:o,params:y(y({},i),{},{createdAt:$e(n||t)}),wait:a||Un()})}function Un(){var e=An.pause||{},t=e.timestamp,n=e.wait,r=Date.now()-(t||0);return r<n?n-r:null}function Fn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cleanUp,n=e.wait;if(An.running)return Tn.resolve({});An.running=!0;var r=Tn.resolve({});return t&&(r=r.then(Mn)),r.then((function(){return Kt.getFirst(On)})).then((function(e){return qn(e,n)}))}function Kn(e){if(void 0!==e)if(e!==Nn){var t=Nn;Nn=e,!e&&t&&Fn(),ce.info("The app is now in ".concat(e?"offline":"online"," mode"))}else ce.error("The app is already in ".concat(e?"offline":"online"," mode"));else ce.error("State not provided, true or false has to be defined")}function Mn(){var e=Date.now()-he.requestValidityWindow;return Kt.deleteBulk(On,e,"upperBound")}var Gn="undefined"==typeof Promise?n(702).Promise:Promise,Vn="globalParams",Jn="No type provided",Wn="Global parameter type not provided, `callback` or `partner` types are available";function Hn(e){return(e||[]).map((function(e){return{key:e.key,value:e.value}}))}function Yn(){return Gn.all([Kt.filterBy(Vn,"callback"),Kt.filterBy(Vn,"partner")]).then((function(e){var t=h(e,2),n=t[0],r=t[1];return{callbackParams:Hn(n),partnerParams:Hn(r)}}))}function zn(e,t){if(void 0===t)return ce.error(Wn),Gn.reject({message:Jn});var n=K(e),r=Object.keys(n).map((function(e){return{key:e,value:n[e],type:t}}));return Gn.all([Kt.filterBy(Vn,t),Kt.addBulk(Vn,r,!0)]).then((function(e){var n=h(e,2),o=n[0],i=n[1],a=M(o.map((function(e){return e.key})),i.map((function(e){return e[0]})));return ce.log("Following ".concat(t," parameters have been saved: ").concat(r.map((function(e){return"".concat(e.key,":").concat(e.value)})).join(", "))),a.length&&ce.log("Keys: ".concat(a.join(", ")," already existed so their values have been updated")),i}))}function Xn(e,t){return void 0===t?(ce.error(Wn),Gn.reject({message:Jn})):Kt.deleteItem(Vn,[e,t]).then((function(n){return ce.log("".concat(e," ").concat(t," parameter has been deleted")),n}))}function Qn(e){return void 0===e?(ce.error(Wn),Gn.reject({message:Jn})):Kt.deleteBulk(Vn,e).then((function(t){return ce.log("All ".concat(e," parameters have been deleted")),t}))}var Zn,$n,er,tr="undefined"==typeof Promise?n(702).Promise:Promise,nr=!1,rr=document;function or(){return er=function(){var e=document;if(void 0!==e.hidden)return{hidden:"hidden",visibilityChange:"visibilitychange"};for(var t=J({mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange",webkitHidden:"webkitvisibilitychange"}),n=0;n<t.length;n+=1){var r=h(t[n],2),o=r[0],i=r[1];if(void 0!==e[o])return{hidden:o,visibilityChange:i}}return null}(),nr?tr.reject({interrupted:!0,message:"Session watch already initiated"}):(nr=!0,vt("session:finished",cr),er&&un(rr,er.visibilityChange,ur),er&&rr[er.hidden]?(ce.log("Session request attempt canceled because the tab is still hidden"),tr.resolve({})):(ft.initParams(),dr()))}function ir(){return lr(),ft.updateSessionOffset(),ft.toBackground(),xn()}function ar(){return Kt.getFirst(Dn).then((function(e){var t=ft.current,n=t.lastActive||0;if(_n()&&n<e.lastActive){var r=!t.installed&&e.installed,o=(t.sessionCount||0)<(e.sessionCount||0);(r||o)&&ht("sdk:installed"),ft.current=e,Et()}return e})).then((function(){ft.updateSessionLength(),ft.toForeground()})).then(dr)}function ur(){clearTimeout($n);var e=er&&rr[er.hidden]?ir:ar;$n=setTimeout(e,0)}function sr(){er&&!rr[er.hidden]&&(Et(),nr||"on"!==Cn()||(sn(rr,er.visibilityChange,sr),qo.__internal__.restartAfterAsyncEnable()))}function cr(e,t){if(!t||"error"!==t.status)return ft.updateInstalled(),ht("sdk:installed"),xn();ce.error("Session was not successful, error was returned from the server:",t.response)}function lr(){clearInterval(Zn)}function dr(){lr(),Zn=setInterval((function(){return ft.updateSessionOffset(),xn()}),he.sessionTimerWindow);var e=ft.current,t=e.lastInterval,n=e.sessionCount>0;return!n||n&&t*w>=he.sessionWindow?Yn().then((function(e){var t,n,r;Ln({url:"/session",method:"POST",params:(t=e,n=t.callbackParams,r=t.partnerParams,{callbackParams:n.length?K(n):null,partnerParams:r.length?K(r):null})},{auto:!0})})):(ht("attribution:check"),xn())}var fr="undefined"==typeof Promise?n(702).Promise:Promise,pr=yn({url:"/attribution",strategy:"short",continueCb:function(e,t,n){if(!e||e&&"error"===e.status)return t(),fr.resolve({state:"unknown"});if(!e.ask_in)return t(),function(e){if(L(e)||!function(e){var t=e.adid,n=void 0===t?"":t,r=e.attribution,o=void 0===r?{}:r;return!!n&&!!M(mr,Object.keys(o)).length}(e)||function(e){var t=e.adid,n=e.attribution,r=ft.current.attribution||{};return!(n&&mr.some((function(e){return r[e]!==n[e]})))&&t===r.adid}(e))return fr.resolve({state:"same"});var t=J(e.attribution).filter((function(e){var t=h(e,1)[0];return-1!==mr.indexOf(t)})).reduce(V,{adid:e.adid});return ft.current=y(y({},ft.current),{},{attribution:t,sdkClickSent:!0}),xn().then((function(){return ht("attribution:change",t),ce.info("Attribution has been updated"),{state:"changed"}}))}(e);return n(e.ask_in)}}),mr=["tracker_token","tracker_name","network","campaign","adgroup","creative","click_label","state"];var vr=yn({url:"/gdpr_forget_device",method:"POST",strategy:"short"}),hr={running:"Adtrace SDK is running pending GDPR Forget Me request",pending:"Adtrace SDK will run GDPR Forget Me request after initialisation",paused:"Adtrace SDK is already prepared to send GDPR Forget Me request",off:"Adtrace SDK is already disabled"};function gr(e){var t=Cn();return e||"on"===t?he.isInitialised()?(vr.send({params:y({},ft.getParams())}).then((function(){ht("sdk:gdpr-forget-me")})),!0):(ce.log(hr.pending),!0):(ce.log(hr[t]),!1)}function yr(){return wn({reason:D,pending:!1},"finish")}var br={running:"Adtrace SDK is running pending third-party sharing opt-out request",delayed:"Adtrace SDK will run third-party sharing opt-out request after initialisation",pending:"Adtrace SDK already queued third-party sharing opt-out request",off:"Third-party sharing opt-out is already done",start:{inProgress:"Third-party sharing opt-out has already started",done:"Third-party sharing opt-out is now started"},finish:{inProgress:"Third-party sharing opt-out has already finished",done:"Third-party sharing opt-out is now finished"}};function kr(){var e=It()||{};return e.reason?e.pending?"pending":"off":"on"}function wr(e){var t=kr();return e||"on"===t?he.isInitialised()?(Ln({url:"/disable_third_party_sharing",method:"POST"}),!0):(ce.log(br.delayed),!0):(ce.log(br[t]),!1)}function Sr(e,t){var n,r,o=It()||{},i="start"===t&&e?"start":"finish",a="start"===t&&o.reason,u="finish"===t&&o.reason&&!o.pending;return a||u?(ce.log(br[i].inProgress),!1):(ce.log(br[i].done),r=(n={reason:P,pending:e})?y({},n):null,bt.stores[kt]=y(y({},St()),{},{thirdPartySharingDisabled:r}),Ct(),!0)}function Cr(){return Sr(!1,"finish")}function Pr(){"pending"===kr()&&(ce.log(br.running),wr(!0))}var Dr=[];function Ir(e,t){Dr.push({method:e,description:t,timestamp:Date.now()})}var Er,_r="undefined"==typeof Promise?n(702).Promise:Promise,xr="eventDeduplication";function Tr(e,t){var n,r,o=t.callbackParams,i=t.partnerParams,a={},u=y({eventToken:e.eventToken,deduplicationId:e.deduplicationId},(n=e.revenue,r=e.currency,isNaN(n)||(n=parseFloat(n))<0||!r?{}:{revenue:n.toFixed(5),currency:r})),s=y(y({},K(o)),K(e.callbackParams)),c=y(y({},K(i)),K(e.partnerParams)),l=y({},K(e.eventValueParams));return L(s)||(a.callbackParams=s),L(c)||(a.partnerParams=c),L(l)||(a.eventValueParams=l),y(y({},u),a)}function Br(e){return e?Kt.getAll(xr).then((function(e){return e.map((function(e){return e.id}))})).then((function(t){return-1===t.indexOf(e)?function(e){var t=he.getCustomConfig().eventDeduplicationListLimit,n=t>0?t:10;return Kt.count(xr).then((function(e){var t=_r.resolve();if(e>=n){var r=e-n+1;ce.log("Event deduplication list limit has been reached. Oldest ids are about to be removed (".concat(r," of them)")),t=Kt.trimItems(xr,r)}return t})).then((function(){return ce.info("New event deduplication id is added to the list: ".concat(e)),Kt.addItem(xr,{id:e})}))}(e):_r.reject({message:"Event won't be tracked, since it was previously tracked with the same deduplication id ".concat(e)})})):_r.resolve()}function Nr(e){return{clickTime:$e(),source:"web_referrer",referrer:decodeURIComponent(e)}}function Or(e,t){var n;(n=e||window.location.search.substring(1).split("&").map((function(e){return e.split("=")})).reduce(V,{}).adtrace_referrer)&&Ln({url:"/sdk_click",method:"POST",params:Nr(n)},{timestamp:t})}function Ar(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}!function(e){e.Android="android",e.iOS="ios",e.WindowsPC="windows",e.WindowsPhone="windows-phone"}(Er||(Er={}));var Rr,jr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"adtrace-smart-banner";ze(this,e),this.storageName=t}return Qe(e,[{key:"setItem",value:function(e,t){localStorage.setItem("".concat(this.storageName,".").concat(e),JSON.stringify(t))}},{key:"getItem",value:function(e){return Ar(localStorage.getItem("".concat(this.storageName,".").concat(e)))}},{key:"removeItem",value:function(e){localStorage.removeItem("".concat(this.storageName,".").concat(e))}}]),e}(),Lr=function(){function e(){ze(this,e),p(this,"items",{})}return Qe(e,[{key:"setItem",value:function(e,t){this.items[e]=t}},{key:"getItem",value:function(e){return Object.prototype.hasOwnProperty.call(this.items,e)?this.items[e]:null}},{key:"removeItem",value:function(e){delete this.items[e]}}]),e}(),qr=function(){function e(){ze(this,e)}return Qe(e,null,[{key:"isLocalStorageSupported",value:function(){try{var e=(new Date).toString(),t=window.localStorage;t.setItem(e,e);var n=t.getItem(e)===e;return t.removeItem(e),!(!n||!t)}catch(e){return!1}}},{key:"createStorage",value:function(){return this.isLocalStorageSupported()?new jr:new Lr}}]),e}();"undefined"==typeof Promise&&n(702).Promise;function Ur(e,t,n){return n.request("/smart_banner",{app_web_token:e}).then((function(e){var n,r,o,i,a,u,s,c=e.find((function(e){return e.platform===t}));return c?(i=(n=c).title,a=n.description,u=n.button_label,s=n.tracker_token,i&&a&&u&&s?{appId:(null===(r=n.app)||void 0===r?void 0:r.default_store_app_id)||"",appName:(null===(o=n.app)||void 0===o?void 0:o.name)||"",position:n.position||Rr.Bottom,imageUrl:n.image_url,header:i,description:a,buttonText:u,trackerToken:s,deeplinkPath:n.deeplink_path,dismissInterval:864e5}:null):null})).catch((function(e){return ce.error("Network error occurred during loading Smart Banner: "+JSON.stringify(e)),null}))}!function(e){e.Top="top",e.Bottom="bottom"}(Rr||(Rr={}));const Fr="adtrace-smart-banner-bannerContainer__AEqYl",Kr="adtrace-smart-banner-banner__NVk5v",Mr="adtrace-smart-banner-stickyToTop__jOV7B",Gr="adtrace-smart-banner-stickyToBottom__XmomY",Vr="adtrace-smart-banner-bannerBody__eXKzW",Jr="adtrace-smart-banner-content__r3JnN",Wr="adtrace-smart-banner-dismiss__VFuxs",Hr="adtrace-smart-banner-appIcon__hqvH8",Yr="adtrace-smart-banner-placeholder__Ll9XM",zr="adtrace-smart-banner-image__VYRfE",Xr="adtrace-smart-banner-textContainer__I8xX0",Qr="adtrace-smart-banner-bannerText__JJLdp",Zr="adtrace-smart-banner-action__risKV";var $r="undefined"==typeof Promise?n(702).Promise:Promise,eo=function(){function e(t,n,r){ze(this,e),p(this,"appTraceUrl",(function(e){return"https://www.apptrace.com/api/app/".concat(e,"/artwork_url_small")})),p(this,"appName",void 0),p(this,"image",void 0),p(this,"placeholder",void 0),this.image=n,this.placeholder=r,this.appName=t.appName;var o=this.getSources(t);this.showImage(o)}return Qe(e,[{key:"getSources",value:function(e){var t=[];return e.imageUrl&&t.push(e.imageUrl),t.push(this.appTraceUrl(e.appId)),t}},{key:"showImage",value:function(e){var t=this;return e.reduce((function(e,n){return e.catch((function(){return t.loadImage(n,t.image)}))}),$r.reject()).then((function(){t.placeholder.remove()})).catch((function(){t.image.remove(),t.placeholder.innerText=t.appName.length?t.appName[0].toUpperCase():""}))}},{key:"loadImage",value:function(e,t){return new $r((function(n,r){t.onload=n,t.onerror=r,t.src=e}))}}]),e}(),to=function(){function e(t,n,r){ze(this,e),p(this,"parent",document.body),p(this,"banner",void 0),p(this,"dismissButton",null),p(this,"onDismiss",void 0),this.onDismiss=n,this.render(t,r)}return Qe(e,[{key:"render",value:function(e,t){this.banner=document.createElement("div"),this.banner.setAttribute("class",Fr);var n=e.position===Rr.Top?Mr:Gr,r=e.deeplinkPath?"?deeplink=".concat(encodeURIComponent(e.deeplinkPath)):"",o="".concat(t,"/").concat(e.trackerToken).concat(r);this.banner.innerHTML=function(e,t,n,r,o){return'\n  <div class="'.concat(Kr," ").concat(e,'">\n    <div class="').concat(Vr,'">\n      <div class="').concat(Jr,'">\n        <button class="').concat(Wr,'"></button>\n        <div class="').concat(Hr,'">\n          <div class="').concat(Yr,'"></div>\n          <img class="').concat(zr,'" alt="').concat(t,'">\n        </div>\n        <div class="').concat(Xr,'">\n          <h4 class="').concat(Qr,'">').concat(t,'</h4>\n          <p class="').concat(Qr,'">').concat(n,'</p>\n        </div>\n        <a class="').concat(Zr,'" href=').concat(o,">").concat(r,"</a>\n      </div>\n    </div>\n  </div>")}(n,e.header,e.description,e.buttonText,o),e.position===Rr.Top?this.parent.insertBefore(this.banner,this.parent.firstChild):this.parent.appendChild(this.banner),this.dismissButton=this.getElemByClass(Wr),this.dismissButton&&this.dismissButton.addEventListener("click",this.onDismiss);var i=this.getElemByClass(Yr),a=this.getElemByClass(zr);a&&i&&new eo(e,a,i)}},{key:"show",value:function(){this.banner.hidden=!1}},{key:"hide",value:function(){this.banner.hidden=!0}},{key:"destroy",value:function(){this.removeDismissButtonHandler(),this.banner.remove()}},{key:"removeDismissButtonHandler",value:function(){this.dismissButton&&this.onDismiss&&(this.dismissButton.removeEventListener("click",this.onDismiss),this.dismissButton=null)}},{key:"getElemByClass",value:function(e){if(this.banner){var t=this.banner.getElementsByClassName(e);return t.length>0?t[0]:null}return null}}]),e}(),no={status:0,message:"No internet connectivity"},ro="undefined"==typeof Promise?n(702).Promise:Promise,oo=function(){function e(t){ze(this,e),this.origin=t}return Qe(e,[{key:"endpoint",get:function(){if(!this.origin)throw Error("XhrNetwork: Origin not defined");return this.origin},set:function(e){this.origin=e}},{key:"xhr",value:function(e){return new ro((function(t,n){var r=new XMLHttpRequest;r.open("GET",e),[["Client-SDK","js".concat(z.version)],["Content-Type","application/json"]].forEach((function(e){var t=h(e,2),n=t[0],o=t[1];r.setRequestHeader(n,o)})),r.onerror=function(){return n(no)},r.onreadystatechange=function(){if(4===r.readyState){var e=r.status>=200&&r.status<300,o=Ar(r.responseText);0===r.status?n(no):e?t(o):n({status:r.status,message:o||r.responseText||""})}},r.send()}))}},{key:"encodeParams",value:function(e){return Object.keys(e).map((function(t){return[encodeURIComponent(t),encodeURIComponent(e[t])].join("=")})).join("&")}},{key:"request",value:function(e,t){var n=t?"?".concat(this.encodeParams(t)):"";return this.xhr("".concat(this.endpoint).concat(e).concat(n))}}]),e}();function io(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ao(e,t){return ao=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ao(e,t)}function uo(e){return uo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},uo(e)}function so(e,t){if(t&&("object"===j(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return io(e)}function co(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=uo(e);if(t){var o=uo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return so(this,n)}}"undefined"==typeof Promise&&n(702).Promise;var lo,fo,po,mo,vo=function(){function e(t){ze(this,e),this.network=t}return Qe(e,[{key:"endpoint",get:function(){return this.network.endpoint},set:function(e){this.network.endpoint=e}},{key:"request",value:function(e,t){return this.network.request(e,t)}}]),e}(),ho=("undefined"==typeof Promise&&n(702).Promise,function(){function e(t){ze(this,e),this.preferredUrls=t}return Qe(e,[{key:"retries",value:function(t){var n=this,r=0;return function o(){var i=n.preferredUrls();if(!i||0===i.length)throw ce.error(e.NoPreferredUrlsDefinedError.message),e.NoPreferredUrlsDefinedError;var a=i[r++];return t(a).catch((function(e){if(e===no&&(ce.log("Failed to connect ".concat(a.endpointName," endpoint")),r<i.length))return ce.log("Trying ".concat(i[r].endpointName," one")),o();throw e}))}()}}]),e}());p(ho,"NoPreferredUrlsDefinedError",new ReferenceError("UrlStrategy: No preferred URL defined")),function(e){e.Default="default",e.India="india",e.China="china";var t,n=(p(t={},lo.Default,T),p(t,lo.India,B),p(t,lo.China,N),t),r=function(e,t){return t===lo.India?[e[lo.India],e[lo.Default]]:t===lo.China?[e[lo.China],e[lo.Default]]:[e[lo.Default],e[lo.India],e[lo.China]]};e.preferredUrlsGetter=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;return function(){return r(t,e)}}}(lo||(lo={})),(fo||(fo={})).preferredUrlsGetter=function(e){return function(){return function(e){return[{endpointName:"Custom (".concat(e,")"),app:e,gdpr:e}]}(e)}},function(e){e.EU="EU",e.TR="TR",e.US="US";var t,n=(p(t={},po.EU,O),p(t,po.TR,A),p(t,po.US,R),t),r=function(e,t){return[e[t]]};e.preferredUrlsGetter=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;return function(){return r(t,e)}}}(po||(po={})),function(e){var t=function(e,t){ce.warn("Both ".concat(e," and ").concat(t," are set in config, ").concat(t," will be ignored"))};e.create=function(e){var n=e.customUrl,r=e.dataResidency,o=e.urlStrategy;return n?((r||o)&&t("customUrl",r?"dataResidency":"urlStrategy"),new ho(fo.preferredUrlsGetter(n))):r?(o&&t("dataResidency","urlStrategy"),new ho(po.preferredUrlsGetter(r))):new ho(lo.preferredUrlsGetter(o))}}(mo||(mo={}));"undefined"==typeof Promise&&n(702).Promise;var go=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ao(e,t)}(n,e);var t=co(n);function n(e,r){var o,i=r.urlStrategy,a=r.urlStrategyConfig;return ze(this,n),p(io(o=t.call(this,e)),"lastSuccessfulEndpoint",void 0),p(io(o),"urlStrategy",void 0),o.urlStrategy=i||mo.create(a),o}return Qe(n,[{key:"endpoint",get:function(){return this.lastSuccessfulEndpoint||n.DEFAULT_ENDPOINT}},{key:"request",value:function(e,t){var n=this;return this.urlStrategy.retries((function(r){return n.network.endpoint=r.app,n.network.request(e,t).then((function(e){return n.lastSuccessfulEndpoint=r.app,e})).catch((function(e){throw n.lastSuccessfulEndpoint=void 0,e}))}))}}]),n}(vo);p(go,"DEFAULT_ENDPOINT",T.app),go||(go={});"undefined"==typeof Promise&&n(702).Promise;var yo=function(){function e(t,n){var r=t.webToken,o=t.logLevel,i=void 0===o?"error":o,a=t.dataResidency,u=t.onCreated,s=t.onDismissed;ze(this,e),p(this,"STORAGE_KEY_DISMISSED","closed"),p(this,"network",void 0),p(this,"storage",void 0),p(this,"timer",null),p(this,"dataFetchPromise",void 0),p(this,"banner",void 0),p(this,"onCreated",void 0),p(this,"onDismissed",void 0),this.onCreated=u,this.onDismissed=s,ce.setLogLevel(i);var c=a?{dataResidency:a}:{};this.network=n||new go(new oo,{urlStrategyConfig:c}),this.storage=qr.createStorage(),this.init(r)}return Qe(e,[{key:"init",value:function(e){var t=this;if(this.banner)ce.error("Smart Banner already exists");else if(this.dataFetchPromise)ce.error("Smart Banner is initialising already");else{var n=function(){var e,t,n=null===(e=navigator)||void 0===e||null===(t=e.userAgent)||void 0===t?void 0:t.toLowerCase();if(n&&!(n.length<1))return/ipad|iphone|ipod/.test(n)?Er.iOS:n.includes("windows")?/phone|mobile/.test(n)?Er.WindowsPhone:Er.WindowsPC:n.includes("android")?Er.Android:void 0}();n?(this.dataFetchPromise=Ur(e,n,this.network),this.dataFetchPromise.then((function(r){if(t.dataFetchPromise=null,r){var o=t.getDateToShowAgain(r.dismissInterval);if(Date.now()<o)return ce.log("Smart Banner was dismissed"),void t.scheduleCreation(e,o);ce.log("Creating Smart Banner"),t.banner=new to(r,(function(){return t.dismiss(e,r.dismissInterval)}),t.network.endpoint),ce.log("Smart Banner created"),t.onCreated&&t.onCreated()}else ce.log("No Smart Banners for ".concat(n," platform found"))}))):ce.log("This platform is not one of the targeting ones, Smart Banner will not be shown")}}},{key:"show",value:function(){var e=this;if(!this.banner)return this.dataFetchPromise?(ce.log("Smart Banner will be shown after initialisation finished"),void this.dataFetchPromise.then((function(){ce.log("Initialisation finished, showing Smart Banner"),e.show()}))):void ce.error("There is no Smart Banner to show, have you called initialisation?");this.banner.show()}},{key:"hide",value:function(){var e=this;if(!this.banner)return this.dataFetchPromise?(ce.log("Smart Banner will be hidden after initialisation finished"),void this.dataFetchPromise.then((function(){ce.log("Initialisation finished, hiding Smart Banner"),e.hide()}))):void ce.error("There is no Smart Banner to hide, have you called initialisation?");this.banner.hide()}},{key:"destroy",value:function(){this.banner?(this.banner.destroy(),this.banner=null,ce.log("Smart Banner removed")):ce.error("There is no Smart Banner to remove")}},{key:"dismiss",value:function(e,t){ce.log("Smart Banner dismissed"),this.storage.setItem(this.STORAGE_KEY_DISMISSED,Date.now());var n=this.getDateToShowAgain(t);this.scheduleCreation(e,n),this.destroy(),this.onDismissed&&this.onDismissed()}},{key:"scheduleCreation",value:function(e,t){var n=this;this.timer&&(ce.log("Clearing previously scheduled creation of Smart Banner"),clearTimeout(this.timer),this.timer=null);var r=t-Date.now();this.timer=setTimeout((function(){n.timer=null,n.init(e)}),r),ce.log("Smart Banner creation scheduled on "+new Date(t))}},{key:"getDateToShowAgain",value:function(e){var t=this.storage.getItem(this.STORAGE_KEY_DISMISSED);return t&&"number"==typeof t?t+e:Date.now()}}]),e}(),bo=["logLevel","logOutput"],ko="undefined"==typeof Promise?n(702).Promise:Promise,wo=null,So=!1,Co=!1,Po=!1,Do=null;function Io(){wr()&&Sr(!0,"start")}function Eo(){var e;"paused"===Cn()&&(yr(),ko.all([(e={uuid:"unknown"},ft.current=e,Kt.clear(Dn).then((function(){return Kt.addItem(Dn,e)}))),Kt.clear(Vn),Kt.clear(On)]).then(Bo))}function _o(){return So||he.isInitialised()}function xo(){So=!1,Co=!1,Dr=[],Bn.clear(),An.running=!1,An.timestamp=null,An.pause=null,nr=!1,ft.toBackground(),lr(),er&&(clearTimeout($n),sn(rr,er.visibilityChange,ur),un(rr,er.visibilityChange,sr)),pr.clear()}function To(e){e&&ce.log("Adtrace SDK has been shutdown due to asynchronous disable"),xo(),mt.forEach(clearTimeout),mt=[],pt={},ft.destroy(),sn(window,"online",on),sn(window,"offline",an),Kt.destroy(),he.destroy()}function Bo(){Po=!1,To(),vr.clear(),wo=null,ce.log("Adtrace SDK instance has been destroyed")}function No(e){ce.log("Adtrace SDK is starting with web_uuid set to ".concat(e.uuid));var t=ft.current.installed;"paused"===Cn()&&(ce.log(hr.running),gr(!0)),t||Pr();var n=Cn(),r=function(e){return"Adtrace SDK start has been interrupted ".concat(e)};return"off"===n?(To(),ko.reject({interrupted:!0,message:r("due to complete async disable")})):"paused"===n?(xo(),ko.reject({interrupted:!0,message:r("due to partial async disable")})):Co?ko.reject({interrupted:!0,message:r("due to multiple synchronous start attempt")}):(Fn({cleanUp:!0}),or().then((function(){So=!1,Co=!0,t&&(Oo(),Pr())})).then((function(){e.sdkClickSent||Lo.setReferrer("adtrace-default-web-referrer")})))}function Oo(){var e;Po=!0,Dr.forEach((function(e){"function"==typeof e.method&&(ce.log("Delayed ".concat(e.description," task is running now")),e.method(e.timestamp))})),Dr=[],(e="sdk:installed")&&J(pt).some((function(t){var n=h(t,2)[1];return n.some((function(t,r){if(t.id===e)return n.splice(r,1),!0}))}))}function Ao(e){if(e.interrupted)ce.log(e.message);else if(To(),ce.error("Adtrace SDK start has been canceled due to an error",e),e.stack)throw e}function Ro(e){"off"!==Cn()?(he.set(e),un(window,"online",on),un(window,"offline",an),vt("sdk:installed",Oo),vt("sdk:shutdown",(function(){return To(!0)})),vt("sdk:gdpr-forget-me",Eo),vt("sdk:third-party-sharing-opt-out",Cr),vt("attribution:check",(function(e,t){return n=t,r=ft.current,(o=(n||{}).ask_in)||!r.attribution&&r.installed?(pr.send({params:y({initiatedBy:n?"backend":"sdk"},ft.getParams()),wait:o}),ft.updateSessionOffset(),xn()):fr.resolve(r);var n,r,o})),"function"==typeof e.attributionCallback&&vt("attribution:change",e.attributionCallback),(In?Pn.reject({interrupted:!0,message:"Adtrace SDK start already in progress"}):(In=!0,Kt.getFirst(Dn).then(En).then((function(e){if(e.exists)return In=!1,e.stored;var t,n=L(ft.current)?{uuid:(t=Date.now(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:11&n).toString(16)}))),sdkClickSent:!1}:ft.current;return Kt.addItem(Dn,n).then((function(){return ft.init(n),Et(),In=!1,n}))})))).then(No).then(Or).catch(Ao)):ce.log("Adtrace SDK is disabled, can not start the sdk")}function jo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.schedule,o=n.waitForInitFinished,i=n.optionalInit;if(Kt.getType()!==E)if("on"===Cn())if(i||_o()||!o){if("function"==typeof t){if(!r||Po&&Co||!i&&!_o())return t();Ir(t,e),ce.log("Running ".concat(e," is delayed until Adtrace SDK is up"))}}else ce.error("Adtrace SDK can not ".concat(e,", sdk instance is not initialized"));else ce.log("Adtrace SDK is disabled, can not ".concat(e));else ce.log("Adtrace SDK can not ".concat(e,", no storage available"))}var Lo={initSdk:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.logLevel,n=e.logOutput,r=b(e,bo);ce.setLogLevel(t,n),_o()?ce.error("You already initiated your instance"):he.hasMissing(r)||(So=!0,Kt.init(r.namespace).then((function(e){e.type!==E?(ce.info("Available storage is ".concat(e.type)),wo=y({},r),Ro(r)):ce.error("Adtrace SDK can not start, there is no storage available")})))},getAttribution:function(){return jo("get attribution",(function(){return ft.getAttribution()}))},getWebUUID:function(){return jo("get web_uuid",(function(){return ft.getWebUUID()}))},setReferrer:function(e){e&&"string"==typeof e?jo("setting reftag",(function(t){return Or(e,t)}),{schedule:!0,waitForInitFinished:!0,optionalInit:!0}):ce.error("You must provide a string referrer")},trackEvent:function(e){return function(e){if(Kt.getType()===E){var t="Adtrace SDK can not track event, no storage available";return ce.log(t),ko.reject(t)}if("on"!==Cn()){var n="Adtrace SDK is disabled, can not track event";return ce.log(n),ko.reject(n)}if(!_o()){var r="Adtrace SDK can not track event, sdk instance is not initialized";return ce.error(r),ko.reject(r)}return new ko((function(t){var n=function(n){return t(function(e,t){if(!e||e&&(L(e)||!e.eventToken)){var n="You must provide event token in order to track event";return ce.error(n),_r.reject(n)}return Br(e.deduplicationId).then(Yn).then((function(n){return Ln({url:"/event",method:"POST",params:Tr(e,n)},{timestamp:t})})).catch((function(e){return e&&e.message&&ce.error(e.message),_r.reject(e)}))}(e,n))};!Po||!Co&&_o()?(Ir(n,"track event"),ce.log("Running track event is delayed until Adtrace SDK is up")):n()}))}(e)},addGlobalCallbackParameters:function(e){jo("add global callback parameters",(function(){return zn(e,"callback")}))},addGlobalPartnerParameters:function(e){jo("add global partner parameters",(function(){return zn(e,"partner")}))},removeGlobalCallbackParameter:function(e){jo("remove global callback parameter",(function(){return Xn(e,"callback")}))},removeGlobalPartnerParameter:function(e){jo("remove global partner parameter",(function(){return Xn(e,"partner")}))},clearGlobalCallbackParameters:function(){jo("remove all global callback parameters",(function(){return Qn("callback")}))},clearGlobalPartnerParameters:function(){jo("remove all global partner parameters",(function(){return Qn("partner")}))},switchToOfflineMode:function(){jo("set offline mode",(function(){return Kn(!0)}))},switchBackToOnlineMode:function(){jo("set online mode",(function(){return Kn(!1)}))},stop:function(){Sn()&&he.isInitialised()&&To()},restart:function(){var e;((e=Pt()||{}).reason===D?(ce.log("Adtrace SDK is disabled due to GDPR-Forget-Me request and it can not be re-enabled"),!1):e.reason?(ce.log("Adtrace SDK has been enabled"),Dt(null),!0):(ce.log("Adtrace SDK is already enabled"),!1))&&wo&&Ro(wo)},gdprForgetMe:function(){var e=gr();e&&(e=Sn(D,!0))&&he.isInitialised()&&xo()},disableThirdPartySharing:function(){jo("disable third-party sharing",Io,{schedule:!0})},initSmartBanner:function(e){Do?ce.error("Smart Banner already initialised"):Do=new yo(e)},showSmartBanner:function(){Do?Do.show():ce.error("Smart Banner is not initialised yet")},hideSmartBanner:function(){Do?Do.hide():ce.error("Smart Banner is not initialised yet")},__testonly__:{destroy:Bo,clearDatabase:function(){return Kt.deleteDatabase()}},__internal__:{restartAfterAsyncEnable:function(){ce.log("Adtrace SDK has been restarted due to asynchronous enable"),wo&&Ro(wo)}}};const qo=Lo;var Uo={},Fo={},Ko={},Mo=!1,Go={},Vo=null;function Jo(e){var t=e.target.id.replace(/(-\w)/g,(function(e){return h(e,2)[1].toUpperCase()})),n=Uo[t],r=Uo[t+"Container"];n.id!==Ko.tab.id&&(n.classList.add("active"),r.classList.add("active"),Ko.tab.classList.remove("active"),Ko.container.classList.remove("active"),Ko.tab=n,Ko.container=r)}function Wo(e){return Object.keys(e).map((function(t){return[t,e[t].value]})).filter((function(e){return h(e,2)[1]})).reduce((function(e,t){var n=h(t,2),r=n[0],o=n[1];return y(y({},e),{},p({},r,o))}),{})}function Ho(e,t){Object.keys(t).map((function(n){return t[n].value=e[n]||""}))}function Yo(){var t;t=(new Date).toISOString(),c.textContent=["[".concat(e,"]"),t,"Log was cleared"].join(" ")+"\n",c.scrollTop=c.scrollHeight,d()}function zo(e){if(e.preventDefault(),!Mo){Mo=!0,Uo.submitButton.classList.add("loading"),Uo.submitButton.disabled=!0;var t=Wo(Fo);$o(t),a("appConfig",t),clearTimeout(Vo),Vo=setTimeout((function(){Mo=!1,Uo.submitButton.classList.remove("loading"),Uo.submitButton.disabled=!1,Jo({target:{id:"log-tab"}}),qo.__testonly__.destroy(),qo.initSdk(y(y({},t),{},{attributionCallback:Zo}))}))}}function Xo(){if(!Mo){Mo=!0,Uo.submitButton.classList.add("loading"),Uo.submitButton.disabled=!0,a("appConfig",null);var e=y({},Go);Ho(e,Fo),$o(e),clearTimeout(Vo),Vo=setTimeout((function(){Mo=!1,Uo.submitButton.classList.remove("loading"),Uo.submitButton.disabled=!1}))}}function Qo(){if(!Mo){Mo=!0,Uo.resetButton.classList.add("loading"),Uo.resetButton.disabled=!0;var e=Wo(Fo);$o(e),o()&&localStorage.clear(),qo.__testonly__.clearDatabase().catch((function(e){throw f("There was an error while attempting to delete the storage, please refresh"),e})).then((function(){a("appConfig",e),f("The storage is deleted and the sdk is re-initiated"),setTimeout((function(){window.location.reload()}))}))}}function Zo(e,t){f("NEW ATTRIBUTION"),f(JSON.stringify(t,void 0,2))}function $o(e){Uo.appConfigJson.textContent="Adtrace.initSdk(".concat(JSON.stringify(e,void 0,2),")")}const ei=function(e){Go=y({},e),Uo.logTab=document.getElementById("log-tab"),Uo.logTabContainer=document.getElementById("log-tab-container"),Uo.logClearButton=document.getElementById("log-tab-clear-button"),Uo.appConfigTab=document.getElementById("app-config-tab"),Uo.appConfigTabContainer=document.getElementById("app-config-tab-container"),Uo.appConfigForm=document.getElementById("app-config-form"),Uo.appConfigJson=document.getElementById("app-config-json"),Uo.submitButton=Uo.appConfigForm.querySelector('button[type="submit"]'),Uo.restoreDefaultConfig=Uo.appConfigForm.querySelector("#restore-default-config"),Uo.resetButton=Uo.appConfigForm.querySelector("#reset"),function(){var e=i("appConfig")||y({},Go);qo.initSdk(y(y({},e),{},{attributionCallback:Zo})),qo.initSmartBanner(y(y({},e),{},{webToken:"p6o2pnb1zkzk",logLevel:"verbose",onCreated:function(){return f("Hey, where is a Smart Banner!")},onDismissed:function(){return f("Oh, you have dismissed the Smart Banner")}})),Fo.appToken=Uo.appConfigForm.querySelector("#app-token"),Fo.environment=Uo.appConfigForm.querySelector("#environment"),Fo.defaultTracker=Uo.appConfigForm.querySelector("#default-tracker"),Fo.customUrl=Uo.appConfigForm.querySelector("#custom-url"),Fo.logLevel=Uo.appConfigForm.querySelector("#log-level"),Fo.dataResidency=Uo.appConfigForm.querySelector("#data-residency"),Fo.urlStrategy=Uo.appConfigForm.querySelector("#url-strategy"),Fo.logOutput=Uo.appConfigForm.querySelector("#log-output"),Fo.eventDeduplicationListLimit=Uo.appConfigForm.querySelector("#event-deduplication-list-limit"),Fo.externalDeviceId=Uo.appConfigForm.querySelector("#external-device-id"),Ho(e,Fo),$o(e)}(),Ko.tab=Uo.logTab,Ko.container=Uo.logTabContainer,Uo.logTab.addEventListener("click",Jo,!1),Uo.logClearButton.addEventListener("click",Yo,!1),Uo.appConfigTab.addEventListener("click",Jo,!1),Uo.appConfigForm.addEventListener("submit",zo,!1),Uo.restoreDefaultConfig.addEventListener("click",Xo,!1),Uo.resetButton.addEventListener("click",Qo,!1)};var ti={add:"+",remove:""},ni="key-input",ri="value-input";function oi(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=document.createElement(e);return(t=i.classList).add.apply(t,k(n)),r&&i.appendChild(document.createTextNode(r)),Object.keys(o).map((function(e){return[e,o[e]]})).map((function(e){var t=h(e,2),n=t[0],r=t[1];return i[n]=r})),i}function ii(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=oi("div",["form-row","flex-one","flex-box-row"]),o=oi("label",["flex-auto"],t),i=oi("input",["flex-one",e],null,{type:"text",value:n});return r.appendChild(o),r.appendChild(i),r}function ai(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=oi("div",["flex-box-row","form-row-group"]),i=ii(ni,"Key",r.key),a=ii(ri,"Value",r.value),u=n?"add":"remove",s=oi("button",["flex-auto",u],ti[u],{type:"button"});s.addEventListener("click",t,!1),o.appendChild(i),o.appendChild(a),o.appendChild(s),e.appendChild(o)}const ui=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=e,o=t,i=null;function a(){i=document.getElementById(r),o.length?o.forEach((function(e,n){var r=n===t.length-1;ai(i,r?l:c,r,e)})):ai(i,l,!0)}function u(){var e=i.querySelectorAll(".form-row-group");return Array.from(e).map((function(e){var t=e.querySelector(".".concat(ni)).value,n=e.querySelector(".".concat(ri)).value;return t&&n?{key:t,value:n}:null})).filter((function(e){return!!e}))}function s(){Array.from(i.querySelectorAll(".form-row-group")).map((function(e){var t=e.querySelector("button"),n=t.classList.contains("add")?l:c;t.removeEventListener("click",n,!1),e.remove()})),ai(i,l,!0)}function c(e){var t=e.target;t.removeEventListener("click",c,!1),t.parentNode.remove(),"function"==typeof n&&n()}function l(e){var t=e.target.parentNode,r=t.querySelector(".".concat(ni)).value,o=t.querySelector(".".concat(ri)).value;r&&o&&(ai(i,l,!0),d(t),"function"==typeof n&&n())}function d(e){var t=oi("button",["flex-auto","remove"],ti.remove,{type:"button"}),n=e.querySelector(".add");t.addEventListener("click",c,!1),n.removeEventListener("click",l,!1),n.remove(),e.appendChild(t)}return{init:a,query:u,reset:s}};var si={},ci={},li={},di=!1,fi=null,pi=null,mi=null,vi=null;function hi(e){if(e.preventDefault(),!di){di=!0,si.submitButton.classList.add("loading"),si.submitButton.disabled=!0;var t=pi.query(),n=mi.query(),r=vi.query(),o={};t.length&&(o.callbackParams=t),n.length&&(o.partnerParams=n),r.length&&(o.eventValueParams=r);var i=Object.keys(ci).map((function(e){return[e,ci[e].value]})).filter((function(e){return h(e,2)[1]})).reduce((function(e,t){var n=h(t,2),r=n[0],o=n[1];return y(y({},e),{},p({},r,o))}),o);ki(i),a("eventConfig",i),clearTimeout(fi),fi=setTimeout((function(){di=!1,si.submitButton.classList.remove("loading"),si.submitButton.disabled=!1,qo.trackEvent(i)}),1e3)}}function gi(){var e=i("eventConfig")||y({},li);di||(di=!0,si.trackEventButton.classList.add("loading"),si.trackEventButton.disabled=!0,clearTimeout(fi),fi=setTimeout((function(){di=!1,si.trackEventButton.classList.remove("loading"),si.trackEventButton.disabled=!1,qo.trackEvent(e)}),1e3))}function yi(e){var t=e.target;t.parentNode.nextElementSibling.classList.toggle("show"),t.classList.toggle("active")}function bi(){var e=i("eventConfig")||y({},li);ci.eventToken=si.eventConfigForm.querySelector("#event-token"),ci.revenue=si.eventConfigForm.querySelector("#revenue"),ci.currency=si.eventConfigForm.querySelector("#currency"),ci.deduplicationId=si.eventConfigForm.querySelector("#deduplication-id"),pi=ui("event-callback-params",e.callbackParams),mi=ui("event-partner-params",e.partnerParams),vi=ui("event-value-params",e.valueParams),pi.init(),mi.init(),vi.init(),Object.keys(ci).map((function(t){return ci[t].value=e[t]||""})),ki(e)}function ki(e){si.eventConfigJson.textContent="Adtrace.trackEvent(".concat(JSON.stringify(e,void 0,2),")")}const wi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};li=y({},e),si.eventConfigForm=document.getElementById("event-config-form"),si.eventConfigJson=document.getElementById("event-config-json"),si.trackEventButton=document.getElementById("track-event-button"),si.toggleButton=document.getElementById("event-side-form-toggle"),si.submitButton=si.eventConfigForm.querySelector('button[type="submit"]'),bi(),si.eventConfigForm.addEventListener("submit",hi,!1),si.toggleButton.addEventListener("click",yi,!1),si.trackEventButton.addEventListener("click",gi,!1)};const Si=function(e,t){var n=e,r=t,o=null,i={},a=!1,u=null,s=null;function c(e){e.preventDefault();var t=s.query();!a&&t.length&&(a=!0,i.submitButton.classList.add("loading"),i.submitButton.disabled=!0,clearTimeout(u),u=setTimeout((function(){a=!1,i.submitButton.classList.remove("loading"),i.submitButton.disabled=!1,qo[r](t),l(),s.reset(),d()}),1e3))}function l(){i.actionButton.nextElementSibling.classList.toggle("show"),i.actionButton.classList.toggle("active")}function d(){i.json.textContent="Adtrace.".concat(r,"(").concat(JSON.stringify(s.query(),void 0,2),")")}return function(){o=document.getElementById(n),i.actionButton=o.querySelector('button[type="button"]'),i.submitButton=o.querySelector('button[type="submit"]'),i.form=o.querySelector("form"),i.json=o.querySelector("pre.config"),i.actionButton.addEventListener("click",l,!1),i.form.addEventListener("submit",c,!1),(s=ui("".concat(n,"-params"),[],d)).init()}};const Ci=function(){Si("addgcp","addGlobalCallbackParameters")()};const Pi=function(){Si("addgpp","addGlobalPartnerParameters")()};const Di=function(e,t){var n=e,r=t,o=null,i={},a=!1,u=null;function s(e){e.preventDefault();var t=i.input.value;!a&&t&&(a=!0,i.submitButton.classList.add("loading"),i.submitButton.disabled=!0,clearTimeout(u),u=setTimeout((function(){a=!1,i.submitButton.classList.remove("loading"),i.submitButton.disabled=!1,qo[r](t),c(),i.input.value="",l()}),1e3))}function c(){i.actionButton.nextElementSibling.classList.toggle("show"),i.actionButton.classList.toggle("active")}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{target:{value:""}};i.json.textContent="Adtrace.".concat(r,"(").concat(e.target.value,")")}return function(){o=document.getElementById(n),i.actionButton=o.querySelector('button[type="button"]'),i.submitButton=o.querySelector('button[type="submit"]'),i.input=o.querySelector("input#".concat(n,"-input")),i.form=o.querySelector("form"),i.json=o.querySelector("pre.config"),i.actionButton.addEventListener("click",c,!1),i.input.addEventListener("keydown",function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){var r=arguments,o=this;clearTimeout(t),t=setTimeout((function(){return e.apply(o,r)}),n)}}(l,200),!1),i.form.addEventListener("submit",s,!1)}};const Ii=function(){Di("removegcp","removeGlobalCallbackParameter")()};const Ei=function(){Di("removegpp","removeGlobalPartnerParameter")()};const _i=function(e,t){var n=e,r=t,o=null,i={},a=!1,u=null;function s(){a||(a=!0,i.actionButton.classList.add("loading"),i.actionButton.disabled=!0,clearTimeout(u),u=setTimeout((function(){a=!1,i.actionButton.classList.remove("loading"),i.actionButton.disabled=!1,r()}),1e3))}function c(){i.toggleButton.parentNode.nextElementSibling.classList.toggle("show"),i.toggleButton.classList.toggle("active")}return function(){o=document.getElementById(n),i.actionButton=o.querySelector('button[type="button"].action'),i.toggleButton=o.querySelector('button[type="button"].toggle'),i.actionButton.addEventListener("click",s,!1),i.toggleButton.addEventListener("click",c,!1)}};const xi=function(){_i("cleargcp",qo.clearGlobalCallbackParameters)()};const Ti=function(){_i("cleargpp",qo.clearGlobalPartnerParameters)()};const Bi=function(){_i("gooffline",qo.switchToOfflineMode)()};const Ni=function(){_i("goonline",qo.switchBackToOnlineMode)()};const Oi=function(){_i("stop",qo.stop)()};const Ai=function(){_i("restart",qo.restart)()};const Ri=function(){_i("gdpr",qo.gdprForgetMe)()};const ji=function(){_i("dtps",qo.disableThirdPartySharing)()};const Li=function(){_i("get-web-uuid",(function(){var e=qo.getWebUUID();e&&(f("Web UUID:"),f(e))}))()};const qi=function(){_i("get-attr",(function(){var e=qo.getAttribution();e&&(f("Attribution:"),f(JSON.stringify(e,void 0,2)))}))()};var Ui={},Fi={},Ki={adtrace_external_click_id:"dummy_id"},Mi=!1,Gi=null;function Vi(e){if(e.preventDefault(),!Mi){Mi=!0,Ui.submitButton.classList.add("loading"),Ui.submitButton.disabled=!0;var t=p({},Fi.reffererKey.value,Fi.reffererValue.value);Hi(t),a("referrerConfig",t);var n=Yi(t);clearTimeout(Gi),Gi=setTimeout((function(){Mi=!1,Ui.submitButton.classList.remove("loading"),Ui.submitButton.disabled=!1,qo.setReferrer(n)}),1e3)}}function Ji(){var e=i("referrerConfig")||y({},Ki);Mi||(Mi=!0,Ui.setReferrerButton.classList.add("loading"),Ui.setReferrerButton.disabled=!0,clearTimeout(Gi),Gi=setTimeout((function(){Mi=!1,Ui.setReferrerButton.classList.remove("loading"),Ui.setReferrerButton.disabled=!1,qo.setReferrer(Yi(e))}),1e3))}function Wi(e){var t=e.target;t.parentNode.nextElementSibling.classList.toggle("show"),t.classList.toggle("active")}function Hi(e){Object.keys(e).map((function(t){Fi.reffererKey.value=t,Fi.reffererValue.value=e[t]})),Ui.referrerConfigJson.textContent='Adtrace.setReferrer("'.concat(Yi(e),'")')}function Yi(e){var t="";return Object.keys(e).map((function(n){t="".concat(n,"=").concat(e[n])})),encodeURIComponent(t)}const zi=function(){var e;Ui.referrerConfigForm=document.getElementById("referrer-config-form"),Ui.referrerConfigJson=document.getElementById("referrer-config-json"),Ui.setReferrerButton=document.getElementById("set-referrer"),Ui.toggleButton=document.getElementById("referrer-side-form-toggle"),Ui.submitButton=Ui.referrerConfigForm.querySelector('button[type="submit"]'),e=i("referrerConfig")||y({},Ki),Fi.reffererKey=Ui.referrerConfigForm.querySelector("#refferer-key"),Fi.reffererValue=Ui.referrerConfigForm.querySelector("#refferer-value"),Object.keys(e).map((function(t){Fi.reffererKey.value=t,Fi.reffererValue.value=e[t]})),Hi(e),Ui.referrerConfigForm.addEventListener("submit",Vi,!1),Ui.toggleButton.addEventListener("click",Wi,!1),Ui.setReferrerButton.addEventListener("click",Ji,!1)};const Xi=function(e,t){l(),ei(e),wi(t),Ci(),Pi(),Ii(),Ei(),xi(),Ti(),Bi(),Ni(),Oi(),Ai(),Ri(),ji(),Li(),qi(),zi()};var Qi={appToken:"wzfjavr56krp",environment:"sandbox",logLevel:"verbose",logOutput:"#log"},Zi={eventToken:"c8qws5"};window.addEventListener("DOMContentLoaded",(function(){Xi(Qi,Zi)}))})()})();